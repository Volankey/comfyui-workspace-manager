import{f as F,p as ut,o as le,j as s,g as E,h as Ve,r as l,d as je,y as Zt,m as ke,b as dt,l as ht,E as qt,W as ft,i as mt,M as Jt,N as Qt,O as en,Q as tn,R as nn,S as sn}from"./input.js";import{aj as rn,a0 as on,h as $e,F as v,ak as an,al as ln,I as M,o as cn,T as un,am as dn,a7 as Z,k as _e,B as xt,l as W,an as hn,C as A,H as Y,n as V,A as pt,ac as gt,i as vt,a9 as $,ao as fn,G as mn}from"./App-JdnHGf6d.js";import{c as Pe,p as xn,r as ot,v as at,I as pn,N as gn,a as vn,b as yn,d as wn,e as Sn,M as yt,u as bn,S as jn}from"./MediaPreview-B-2pnayb.js";import{S as kn}from"./chunk-3RSXBRAN-xTFTRDOB.js";import{u as Pn,C as Be,G as Cn}from"./chunk-JARCRF6W-BckiXUlZ.js";import{app as re}from"/scripts/app.js";import{L as Me}from"./chunk-K7XRJ7NL-BL_zx934.js";import"/scripts/api.js";import"./IconSearch-B-htZoUE.js";import"./index-DdrsuNi1.js";const wt=1/60*1e3,In=typeof performance<"u"?()=>performance.now():()=>Date.now(),St=typeof window<"u"?e=>window.requestAnimationFrame(e):e=>setTimeout(()=>e(In()),wt);function Tn(e){let t=[],r=[],n=0,o=!1,a=!1;const h=new WeakSet,f={schedule:(i,u=!1,d=!1)=>{const c=d&&o,g=c?t:r;return u&&h.add(i),g.indexOf(i)===-1&&(g.push(i),c&&o&&(n=t.length)),i},cancel:i=>{const u=r.indexOf(i);u!==-1&&r.splice(u,1),h.delete(i)},process:i=>{if(o){a=!0;return}if(o=!0,[t,r]=[r,t],r.length=0,n=t.length,n)for(let u=0;u<n;u++){const d=t[u];d(i),h.has(d)&&(f.schedule(d),e())}o=!1,a&&(a=!1,f.process(i))}};return f}const En=40;let De=!0,X=!1,ze=!1;const O={delta:0,timestamp:0},q=["read","update","preRender","render","postRender"],ie=q.reduce((e,t)=>(e[t]=Tn(()=>X=!0),e),{}),Nn=q.reduce((e,t)=>{const r=ie[t];return e[t]=(n,o=!1,a=!1)=>(X||Dn(),r.schedule(n,o,a)),e},{}),_n=q.reduce((e,t)=>(e[t]=ie[t].cancel,e),{});q.reduce((e,t)=>(e[t]=()=>ie[t].process(O),e),{});const Mn=e=>ie[e].process(O),bt=e=>{X=!1,O.delta=De?wt:Math.max(Math.min(e-O.timestamp,En),1),O.timestamp=e,ze=!0,q.forEach(Mn),ze=!1,X&&(De=!1,St(bt))},Dn=()=>{X=!0,De=!0,ze||St(bt)},lt=()=>O;var jt=F(function(t,r){const n=ut("Code",t),{className:o,...a}=le(t);return s.jsx(E.code,{ref:r,className:Ve("chakra-code",t.className),...a,__css:{display:"inline-block",...n}})});jt.displayName="Code";var L=e=>e?"":void 0,Ce=e=>e?!0:void 0,J=(...e)=>e.filter(Boolean).join(" ");function Ie(...e){return function(r){e.some(n=>(n==null||n(r),r==null?void 0:r.defaultPrevented))}}function ee(e){const{orientation:t,vertical:r,horizontal:n}=e;return t==="vertical"?r:n}var ne={width:0,height:0},te=e=>e||ne;function zn(e){const{orientation:t,thumbPercents:r,thumbRects:n,isReversed:o}=e,a=y=>{var w;const N=(w=n[y])!=null?w:ne;return{position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...ee({orientation:t,vertical:{bottom:`calc(${r[y]}% - ${N.height/2}px)`},horizontal:{left:`calc(${r[y]}% - ${N.width/2}px)`}})}},h=t==="vertical"?n.reduce((y,w)=>te(y).height>te(w).height?y:w,ne):n.reduce((y,w)=>te(y).width>te(w).width?y:w,ne),f={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0,...ee({orientation:t,vertical:h?{paddingLeft:h.width/2,paddingRight:h.width/2}:{},horizontal:h?{paddingTop:h.height/2,paddingBottom:h.height/2}:{}})},i={position:"absolute",...ee({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},u=r.length===1,d=[0,o?100-r[0]:r[0]],c=u?d:r;let g=c[0];!u&&o&&(g=100-g);const p=Math.abs(c[c.length-1]-c[0]),k={...i,...ee({orientation:t,vertical:o?{height:`${p}%`,top:`${g}%`}:{height:`${p}%`,bottom:`${g}%`},horizontal:o?{width:`${p}%`,right:`${g}%`}:{width:`${p}%`,left:`${g}%`}})};return{trackStyle:i,innerTrackStyle:k,rootStyle:f,getThumbStyle:a}}function Rn(e){const{isReversed:t,direction:r,orientation:n}=e;return r==="ltr"||n==="vertical"?t:!t}function An(e,t,r,n){return e.addEventListener(t,r,n),()=>{e.removeEventListener(t,r,n)}}function Fn(e){const t=$n(e);return typeof t.PointerEvent<"u"&&e instanceof t.PointerEvent?e.pointerType==="mouse":e instanceof t.MouseEvent}function kt(e){return!!e.touches}function Vn(e){return kt(e)&&e.touches.length>1}function $n(e){var t;return(t=e.view)!=null?t:window}function Bn(e,t="page"){const r=e.touches[0]||e.changedTouches[0];return{x:r[`${t}X`],y:r[`${t}Y`]}}function Ln(e,t="page"){return{x:e[`${t}X`],y:e[`${t}Y`]}}function Pt(e,t="page"){return kt(e)?Bn(e,t):Ln(e,t)}function On(e){return t=>{const r=Fn(t);(!r||r&&t.button===0)&&e(t)}}function Gn(e,t=!1){function r(o){e(o,{point:Pt(o)})}return t?On(r):r}function se(e,t,r,n){return An(e,t,Gn(r,t==="pointerdown"),n)}var Hn=Object.defineProperty,Un=(e,t,r)=>t in e?Hn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,T=(e,t,r)=>(Un(e,typeof t!="symbol"?t+"":t,r),r),Kn=class{constructor(e,t,r){T(this,"history",[]),T(this,"startEvent",null),T(this,"lastEvent",null),T(this,"lastEventInfo",null),T(this,"handlers",{}),T(this,"removeListeners",()=>{}),T(this,"threshold",3),T(this,"win"),T(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const f=Te(this.lastEventInfo,this.history),i=this.startEvent!==null,u=Zn(f.offset,{x:0,y:0})>=this.threshold;if(!i&&!u)return;const{timestamp:d}=lt();this.history.push({...f.point,timestamp:d});const{onStart:c,onMove:g}=this.handlers;i||(c==null||c(this.lastEvent,f),this.startEvent=this.lastEvent),g==null||g(this.lastEvent,f)}),T(this,"onPointerMove",(f,i)=>{this.lastEvent=f,this.lastEventInfo=i,Nn.update(this.updatePoint,!0)}),T(this,"onPointerUp",(f,i)=>{const u=Te(i,this.history),{onEnd:d,onSessionEnd:c}=this.handlers;c==null||c(f,u),this.end(),!(!d||!this.startEvent)&&(d==null||d(f,u))});var n;if(this.win=(n=e.view)!=null?n:window,Vn(e))return;this.handlers=t,r&&(this.threshold=r),e.stopPropagation(),e.preventDefault();const o={point:Pt(e)},{timestamp:a}=lt();this.history=[{...o.point,timestamp:a}];const{onSessionStart:h}=t;h==null||h(e,Te(o,this.history)),this.removeListeners=Xn(se(this.win,"pointermove",this.onPointerMove),se(this.win,"pointerup",this.onPointerUp),se(this.win,"pointercancel",this.onPointerUp))}updateHandlers(e){this.handlers=e}end(){var e;(e=this.removeListeners)==null||e.call(this),_n.update(this.updatePoint)}};function it(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Te(e,t){return{point:e.point,delta:it(e.point,t[t.length-1]),offset:it(e.point,t[0]),velocity:Yn(t,.1)}}var Wn=e=>e*1e3;function Yn(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,n=null;const o=e[e.length-1];for(;r>=0&&(n=e[r],!(o.timestamp-n.timestamp>Wn(t)));)r--;if(!n)return{x:0,y:0};const a=(o.timestamp-n.timestamp)/1e3;if(a===0)return{x:0,y:0};const h={x:(o.x-n.x)/a,y:(o.y-n.y)/a};return h.x===1/0&&(h.x=0),h.y===1/0&&(h.y=0),h}function Xn(...e){return t=>e.reduce((r,n)=>n(r),t)}function Ee(e,t){return Math.abs(e-t)}function ct(e){return"x"in e&&"y"in e}function Zn(e,t){if(typeof e=="number"&&typeof t=="number")return Ee(e,t);if(ct(e)&&ct(t)){const r=Ee(e.x,t.x),n=Ee(e.y,t.y);return Math.sqrt(r**2+n**2)}return 0}function Ct(e){const t=l.useRef(null);return t.current=e,t}function qn(e,t){const{onPan:r,onPanStart:n,onPanEnd:o,onPanSessionStart:a,onPanSessionEnd:h,threshold:f}=t,i=!!(r||n||o||a||h),u=l.useRef(null),d=Ct({onSessionStart:a,onSessionEnd:h,onStart:n,onMove:r,onEnd(c,g){u.current=null,o==null||o(c,g)}});l.useEffect(()=>{var c;(c=u.current)==null||c.updateHandlers(d.current)}),l.useEffect(()=>{const c=e.current;if(!c||!i)return;function g(p){u.current=new Kn(p,d.current,f)}return se(c,"pointerdown",g)},[e,i,d,f]),l.useEffect(()=>()=>{var c;(c=u.current)==null||c.end(),u.current=null},[])}function Jn(e,t){if(!e){t(void 0);return}t({width:e.offsetWidth,height:e.offsetHeight});const r=e.ownerDocument.defaultView??window,n=new r.ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const[a]=o;let h,f;if("borderBoxSize"in a){const i=a.borderBoxSize,u=Array.isArray(i)?i[0]:i;h=u.inlineSize,f=u.blockSize}else h=e.offsetWidth,f=e.offsetHeight;t({width:h,height:f})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)}var Qn=globalThis!=null&&globalThis.document?l.useLayoutEffect:l.useEffect;function es(e,t){var r,n;if(!e||!e.parentElement)return;const o=(n=(r=e.ownerDocument)==null?void 0:r.defaultView)!=null?n:window,a=new o.MutationObserver(()=>{t()});return a.observe(e.parentElement,{childList:!0}),()=>{a.disconnect()}}function ts({getNodes:e,observeMutation:t=!0}){const[r,n]=l.useState([]),[o,a]=l.useState(0);return Qn(()=>{const h=e(),f=h.map((i,u)=>Jn(i,d=>{n(c=>[...c.slice(0,u),d,...c.slice(u+1)])}));if(t){const i=h[0];f.push(es(i,()=>{a(u=>u+1)}))}return()=>{f.forEach(i=>{i==null||i()})}},[o]),r}function ns(e){return typeof e=="object"&&e!==null&&"current"in e}function ss(e){const[t]=ts({observeMutation:!1,getNodes(){return[ns(e)?e.current:e]}});return t}function rs(e){var t;const{min:r=0,max:n=100,onChange:o,value:a,defaultValue:h,isReversed:f,direction:i="ltr",orientation:u="horizontal",id:d,isDisabled:c,isReadOnly:g,onChangeStart:p,onChangeEnd:k,step:y=1,getAriaValueText:w,"aria-valuetext":N,"aria-label":B,"aria-labelledby":b,name:D,focusThumbOnChange:At=!0,...Le}=e,Oe=je(p),G=je(k),Ge=je(w),I=Rn({isReversed:f,direction:i,orientation:u}),[Ft,fe]=rn({value:a,defaultValue:h??as(r,n),onChange:o}),[me,He]=l.useState(!1),[xe,Ue]=l.useState(!1),pe=!(c||g),ge=(n-r)/10,H=y||(n-r)/100,S=Pe(Ft,r,n),Vt=n-S+r,Ke=at(I?Vt:S,r,n),Q=u==="vertical",j=Ct({min:r,max:n,step:y,isDisabled:c,value:S,isInteractive:pe,isReversed:I,isVertical:Q,eventSource:null,focusThumbOnChange:At,orientation:u}),ve=l.useRef(null),ye=l.useRef(null),We=l.useRef(null),$t=l.useId(),Ye=d??$t,[Xe,Ze]=[`slider-thumb-${Ye}`,`slider-track-${Ye}`],Bt=l.useCallback(m=>{var x,U;if(!ve.current)return;const P=j.current;P.eventSource="pointer";const _=ve.current.getBoundingClientRect(),{clientX:Se,clientY:Wt}=(U=(x=m.touches)==null?void 0:x[0])!=null?U:m,Yt=Q?_.bottom-Wt:Se-_.left,Xt=Q?_.height:_.width;let be=Yt/Xt;I&&(be=1-be);let K=xn(be,P.min,P.max);return P.step&&(K=parseFloat(ot(K,P.min,P.step))),K=Pe(K,P.min,P.max),K},[Q,I,j]),z=l.useCallback(m=>{const x=j.current;x.isInteractive&&(m=parseFloat(ot(m,x.min,H)),m=Pe(m,x.min,x.max),fe(m))},[H,fe,j]),R=l.useMemo(()=>({stepUp(m=H){const x=I?S-m:S+m;z(x)},stepDown(m=H){const x=I?S+m:S-m;z(x)},reset(){z(h||0)},stepTo(m){z(m)}}),[z,I,S,H,h]),qe=l.useCallback(m=>{const x=j.current,P={ArrowRight:()=>R.stepUp(),ArrowUp:()=>R.stepUp(),ArrowLeft:()=>R.stepDown(),ArrowDown:()=>R.stepDown(),PageUp:()=>R.stepUp(ge),PageDown:()=>R.stepDown(ge),Home:()=>z(x.min),End:()=>z(x.max)}[m.key];P&&(m.preventDefault(),m.stopPropagation(),P(m),x.eventSource="keyboard")},[R,z,ge,j]),Je=(t=Ge==null?void 0:Ge(S))!=null?t:N,we=ss(ye),{getThumbStyle:Qe,rootStyle:et,trackStyle:tt,innerTrackStyle:nt}=l.useMemo(()=>{const m=j.current,x=we??{width:0,height:0};return zn({isReversed:I,orientation:m.orientation,thumbRects:[x],thumbPercents:[Ke]})},[I,we,Ke,j]),st=l.useCallback(()=>{j.current.focusThumbOnChange&&setTimeout(()=>{var x;return(x=ye.current)==null?void 0:x.focus()})},[j]);Zt(()=>{const m=j.current;st(),m.eventSource==="keyboard"&&(G==null||G(m.value))},[S,G]);function rt(m){const x=Bt(m);x!=null&&x!==j.current.value&&fe(x)}qn(We,{onPanSessionStart(m){const x=j.current;x.isInteractive&&(He(!0),st(),rt(m),Oe==null||Oe(x.value))},onPanSessionEnd(){const m=j.current;m.isInteractive&&(He(!1),G==null||G(m.value))},onPan(m){j.current.isInteractive&&rt(m)}});const Lt=l.useCallback((m={},x=null)=>({...m,...Le,ref:ke(x,We),tabIndex:-1,"aria-disabled":Ce(c),"data-focused":L(xe),style:{...m.style,...et}}),[Le,c,xe,et]),Ot=l.useCallback((m={},x=null)=>({...m,ref:ke(x,ve),id:Ze,"data-disabled":L(c),style:{...m.style,...tt}}),[c,Ze,tt]),Gt=l.useCallback((m={},x=null)=>({...m,ref:x,style:{...m.style,...nt}}),[nt]),Ht=l.useCallback((m={},x=null)=>({...m,ref:ke(x,ye),role:"slider",tabIndex:pe?0:void 0,id:Xe,"data-active":L(me),"aria-valuetext":Je,"aria-valuemin":r,"aria-valuemax":n,"aria-valuenow":S,"aria-orientation":u,"aria-disabled":Ce(c),"aria-readonly":Ce(g),"aria-label":B,"aria-labelledby":B?void 0:b,style:{...m.style,...Qe(0)},onKeyDown:Ie(m.onKeyDown,qe),onFocus:Ie(m.onFocus,()=>Ue(!0)),onBlur:Ie(m.onBlur,()=>Ue(!1))}),[pe,Xe,me,Je,r,n,S,u,c,g,B,b,Qe,qe]),Ut=l.useCallback((m,x=null)=>{const U=!(m.value<r||m.value>n),P=S>=m.value,_=at(m.value,r,n),Se={position:"absolute",pointerEvents:"none",...os({orientation:u,vertical:{bottom:I?`${100-_}%`:`${_}%`},horizontal:{left:I?`${100-_}%`:`${_}%`}})};return{...m,ref:x,role:"presentation","aria-hidden":!0,"data-disabled":L(c),"data-invalid":L(!U),"data-highlighted":L(P),style:{...m.style,...Se}}},[c,I,n,r,u,S]),Kt=l.useCallback((m={},x=null)=>({...m,ref:x,type:"hidden",value:S,name:D}),[D,S]);return{state:{value:S,isFocused:xe,isDragging:me},actions:R,getRootProps:Lt,getTrackProps:Ot,getInnerTrackProps:Gt,getThumbProps:Ht,getMarkerProps:Ut,getInputProps:Kt}}function os(e){const{orientation:t,vertical:r,horizontal:n}=e;return t==="vertical"?r:n}function as(e,t){return t<e?e:e+(t-e)/2}var[ls,ce]=dt({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[is,ue]=dt({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),It=F((e,t)=>{var r;const n={...e,orientation:(r=e==null?void 0:e.orientation)!=null?r:"horizontal"},o=ht("Slider",n),a=le(n),{direction:h}=qt();a.direction=h;const{getInputProps:f,getRootProps:i,...u}=rs(a),d=i(),c=f({},t);return s.jsx(ls,{value:u,children:s.jsx(is,{value:o,children:s.jsxs(E.div,{...d,className:J("chakra-slider",n.className),__css:o.container,children:[n.children,s.jsx("input",{...c})]})})})});It.displayName="Slider";var Tt=F((e,t)=>{const{getThumbProps:r}=ce(),n=ue(),o=r(e,t);return s.jsx(E.div,{...o,className:J("chakra-slider__thumb",e.className),__css:n.thumb})});Tt.displayName="SliderThumb";var Et=F((e,t)=>{const{getTrackProps:r}=ce(),n=ue(),o=r(e,t);return s.jsx(E.div,{...o,className:J("chakra-slider__track",e.className),__css:n.track})});Et.displayName="SliderTrack";var Nt=F((e,t)=>{const{getInnerTrackProps:r}=ce(),n=ue(),o=r(e,t);return s.jsx(E.div,{...o,className:J("chakra-slider__filled-track",e.className),__css:n.filledTrack})});Nt.displayName="SliderFilledTrack";var cs=F((e,t)=>{const{getMarkerProps:r}=ce(),n=ue(),o=r(e,t);return s.jsx(E.div,{...o,className:J("chakra-slider__marker",e.className),__css:n.mark})});cs.displayName="SliderMark";var Re=F(function(t,r){const n=ht("Switch",t),{spacing:o="0.5rem",children:a,...h}=le(t),{getIndicatorProps:f,getInputProps:i,getCheckboxProps:u,getRootProps:d,getLabelProps:c}=Pn(h),g=l.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...n.container}),[n.container]),p=l.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...n.track}),[n.track]),k=l.useMemo(()=>({userSelect:"none",marginStart:o,...n.label}),[o,n.label]);return s.jsxs(E.label,{...d(),className:Ve("chakra-switch",t.className),__css:g,children:[s.jsx("input",{className:"chakra-switch__input",...i({},r)}),s.jsx(E.span,{...u(),className:"chakra-switch__track",__css:p,children:s.jsx(E.span,{__css:n.thumb,className:"chakra-switch__thumb",...f()})}),a&&s.jsx(E.span,{className:"chakra-switch__label",...c(),__css:k,children:a})]})});Re.displayName="Switch";function us(e,t=[]){const r=Object.assign({},e);for(const n of t)n in r&&delete r[n];return r}var ds=["h","minH","height","minHeight"],_t=F((e,t)=>{const r=ut("Textarea",e),{className:n,rows:o,...a}=le(e),h=on(a),f=o?us(r,ds):r;return s.jsx(E.textarea,{ref:t,rows:o,...h,className:Ve("chakra-textarea",n),__css:f})});_t.displayName="Textarea";var hs=$e("chevron-left","IconChevronLeft",[["path",{d:"M15 6l-6 6l6 6",key:"svg-0"}]]),Mt=$e("pin-filled","IconPinFilled",[["path",{d:"M15.113 3.21l.094 .083l5.5 5.5a1 1 0 0 1 -1.175 1.59l-3.172 3.171l-1.424 3.797a1 1 0 0 1 -.158 .277l-.07 .08l-1.5 1.5a1 1 0 0 1 -1.32 .082l-.095 -.083l-2.793 -2.792l-3.793 3.792a1 1 0 0 1 -1.497 -1.32l.083 -.094l3.792 -3.793l-2.792 -2.793a1 1 0 0 1 -.083 -1.32l.083 -.094l1.5 -1.5a1 1 0 0 1 .258 -.187l.098 -.042l3.796 -1.425l3.171 -3.17a1 1 0 0 1 1.497 -1.26z",fill:"currentColor",key:"svg-0",strokeWidth:"0"}]]),Dt=$e("pin","IconPin",[["path",{d:"M15 4.5l-4 4l-4 1.5l-1.5 1.5l7 7l1.5 -1.5l1.5 -4l4 -4",key:"svg-0"}],["path",{d:"M9 15l-4.5 4.5",key:"svg-1"}],["path",{d:"M14.5 4l5.5 5.5",key:"svg-2"}]]);const fs=({setMediaAct:e,media:t,currentNum:r})=>{const n=h=>{const f=(r+h+t.length)%t.length;e&&e(t[f])},o={width:"100%",height:"100%"};if(t.length===0)return s.jsx("p",{children:"No images found, let's start generating ðŸª„"});const a=t.at(r);return a?s.jsxs(v,{justifyContent:"center",alignItems:"center",position:"relative",width:o.width,height:o.height,overflow:"hidden",children:[s.jsx("div",{style:{position:"absolute",cursor:"pointer",width:"100%",height:"100%"},onClick:()=>{window.open(a.imageUrl)},children:an(a.imageUrl)?s.jsx(ln,{src:a.imageUrl,alt:`image-${a.id}`,width:"100%",height:"100%",objectFit:"contain"}):s.jsx("video",{style:{objectFit:"contain"},width:"100%",height:"100%",src:a.imageUrl,loop:!0,autoPlay:!0,muted:!0,children:s.jsx("track",{kind:"captions"})})},a.id),s.jsx(M,{size:"sm",color:"white",bgColor:"whiteAlpha.400","aria-label":"Previous image",icon:s.jsx(hs,{}),onClick:()=>n(-1),position:"absolute",left:"0",zIndex:"2"}),s.jsx(M,{size:"sm",color:"white",bgColor:"whiteAlpha.400","aria-label":"Next image",icon:s.jsx(pn,{}),onClick:()=>n(1),position:"absolute",right:"0",zIndex:"2"})]}):null},ms=({inputItem:e})=>s.jsxs(v,{gap:2,children:[s.jsx(v,{gap:1,alignItems:"center",flexBasis:"200px",children:e.label??e.inputName}),s.jsx(cn,{value:e.inputValue,onChange:t=>{}})]}),xs=e=>{const t=e.inputItem;return s.jsxs(v,{gap:1,direction:"column",children:[s.jsxs(v,{gap:2,children:[s.jsx(v,{gap:1,alignItems:"center",flexBasis:"200px",children:t.label??t.inputName}),s.jsxs(gn,{width:"100%",step:e==null?void 0:e.step,value:t.inputValue,min:e==null?void 0:e.min,max:e==null?void 0:e.max,onChange:r=>{},children:[s.jsx(vn,{}),s.jsxs(yn,{children:[s.jsx(wn,{}),s.jsx(Sn,{})]})]})]}),s.jsx(v,{children:s.jsxs(It,{maxWidth:"400px",step:e==null?void 0:e.step,value:Number(t.inputValue),min:(e==null?void 0:e.min)??0,max:(e==null?void 0:e.max)??100,onChange:r=>{},children:[s.jsx(Et,{children:s.jsx(Nt,{})}),s.jsx(Tt,{})]})})]})},ps=e=>{var r;const{inputItem:t}=e;return s.jsxs(v,{gap:2,children:[s.jsx(v,{gap:1,alignItems:"center",flexBasis:"200px",children:t.label??t.inputName}),s.jsx(kn,{value:t.inputValue,onChange:n=>{},children:(r=e==null?void 0:e.options)==null?void 0:r.map((n,o)=>s.jsx("option",{value:n,children:n},`select${t.nodeID}${t.inputName}${o}`))})]})},gs=e=>{const t=e.inputItem;return s.jsxs(v,{gap:1,direction:"column",children:[s.jsx(v,{children:t.label??t.inputName}),s.jsx(_t,{value:t.inputValue,onChange:r=>{},rows:5})]})};var C=(e=>(e.Input="Input",e.InputSlider="InputSlider",e.Select="Select",e.Textarea="Textarea",e.Checkbox="Checkbox",e.NoSupport="NoSupport",e))(C||{});const vs=e=>s.jsxs(v,{gap:2,children:[s.jsx(v,{gap:1,alignItems:"center",flexBasis:"200px",children:e.inputItem.label??e.inputItem.inputName}),s.jsx(v,{children:"No Support"})]}),ys=e=>{const t=e.inputItem;return s.jsxs(v,{gap:2,children:[s.jsx(v,{gap:1,alignItems:"center",flexBasis:"200px",children:t.label??t.inputName}),s.jsx(Be,{defaultChecked:!!t.inputValue,onChange:r=>{var n;(n=e==null?void 0:e.updateMetaData)==null||n.call(e,{promptKey:e.promptKey,name:e.name,value:r.target.checked})}})]})},de=l.createContext({topFields:[],calcInputList:[],showNodeName:!1,updateTopField(){}}),ws={[C.Input]:ms,[C.InputSlider]:xs,[C.Select]:ps,[C.Textarea]:gs,[C.Checkbox]:ys,NoSupport:vs},Ss=LiteGraph.registered_node_types;function bs(e,t){var o,a,h,f,i;const r=(o=Ss[e])==null?void 0:o.nodeData,n={...((a=r==null?void 0:r.input)==null?void 0:a.required)??{},...((h=r==null?void 0:r.input)==null?void 0:h.optional)??{}}[t];return(n==null?void 0:n[0])==="STRING"?(f=n==null?void 0:n[1])!=null&&f.multiline?{type:C.Textarea}:{type:C.Input}:(n==null?void 0:n[0])==="BOOLEAN"?{type:C.Checkbox}:(n==null?void 0:n[0])==="FLOAT"?{...(n==null?void 0:n[1])??{},type:C.InputSlider}:(n==null?void 0:n[0])==="INT"?{...(n==null?void 0:n[1])??{},type:C.InputSlider}:Array.isArray(n==null?void 0:n[0])&&((i=n==null?void 0:n[0])!=null&&i.every(u=>typeof u=="string"))?{options:n==null?void 0:n[0],type:C.Select}:{type:C.NoSupport}}const Ae=({inputItem:e})=>{const t=bs(e.classType,e.inputName),[r,n]=l.useState(!1),o=ws[t.type??"Input"],{updateTopField:a,topFields:h}=l.useContext(de),f=e.children[0]==="negative"||e.children[0]==="positive"?`-${e.children[0]}`:"",i={...e,label:e.label??e.inputName+f};return s.jsxs(v,{alignItems:"center",onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),children:[s.jsx(M,{size:"xs",onClick:()=>a==null?void 0:a({name:e.inputName,promptKey:e.nodeID,class_type:e.classType}),variant:"ghost",icon:ae(h,{name:e.inputName,promptKey:e.nodeID,classType:e.classType})?s.jsx(Mt,{size:14}):s.jsx(Dt,{size:14}),"aria-label":"pin"}),s.jsxs("div",{style:{flex:1},children:[s.jsx(o,{inputItem:i,...t}),e.latestInputVal!==void 0?s.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[s.jsx(un,{size:"sm",variant:"outline",colorScheme:"blue",children:s.jsx(dn,{children:"Latest"})}),s.jsx(jt,{style:{flex:1,maxHeight:"80px",overflow:"auto"},colorScheme:"yellow",children:e.latestInputVal})]}):null]})]})};function js(){const{topFields:e,updateTopField:t,calcInputList:r}=l.useContext(de);return e.length===0?null:s.jsx(s.Fragment,{children:s.jsx(v,{px:2,gap:2,direction:"column",children:e==null?void 0:e.map(n=>{const o=r.find(a=>a.nodeID==n.promptKey&&a.inputName===n.name&&a.classType===n.class_type);return!n.class_type||!o?null:s.jsx(Ae,{inputItem:o},`formTopField${n.promptKey}${n.name}`)})})})}let oe=[],Fe=new Set;function zt(e,t){if(!Fe.has(e.nodeID))return Fe.add(e.nodeID),Object.entries(e.inputs).forEach(([r,n])=>{if(Array.isArray(n)){const o=n[0];zt(t[o],t)}}),Object.entries(e.inputs).forEach(([r,n])=>{Array.isArray(n)||oe.push({classType:e.class_type,inputName:r,inputValue:n,nodeID:e.nodeID,children:e.children||[]})}),oe}function Rt(e){oe=[],Fe=new Set;for(const t of Object.keys(e))e[t].nodeID=t,Object.entries(e[t].inputs).forEach(([r,n])=>{if(Array.isArray(n)){const o=n[0],a=e[o];a.children||(a.children=[]),a.children.push(r)}});for(const t of Object.keys(e))zt(e[t],e);return oe}function ks(){const{topFields:e,calcInputList:t,showNodeName:r}=l.useContext(de),{curFlowID:n}=l.useContext(Z),o=l.useCallback(d=>{const c=[];return d.forEach(g=>{const p=c[c.length-1];!p||p[0].nodeID!==g.nodeID||p[0].classType!==g.classType?c.push([g]):p.push(g)}),c},[]);l.useEffect(()=>{},[r]);const[a,h]=l.useState(),[f,i]=l.useState([]);if(l.useEffect(()=>{if(!a)return;const d=Rt(a);i(d)},[a]),l.useEffect(()=>{async function d(){re.graphToPrompt(re.graph).then(c=>{h(c.output)})}n&&d()},[n]),l.useEffect(()=>{t.forEach((d,c)=>{const g=f[c];d.nodeID===g.nodeID&&d.inputName===g.inputName&&g.inputValue!==d.inputValue&&(d.latestInputVal=g.inputValue)})},[f,t]),!r)return s.jsx(_e,{children:t.map((d,c)=>ae(e,{name:d.inputName,promptKey:d.nodeID,classType:d.classType})?null:s.jsx(Ae,{inputItem:d},`form${d.nodeID}${d.inputName}`))});const u=o(t);return s.jsx(_e,{children:u.map(d=>d[0]?s.jsx(Ps,{title:d[0].classType+" #"+d[0].nodeID,children:s.jsx(v,{px:2,gap:1,direction:"column",children:d.map(c=>ae(e,{name:c.inputName,promptKey:c.nodeID,classType:c.classType})?null:s.jsx(Ae,{inputItem:c},`form${c.nodeID}${c.inputName}`))})},d[0].nodeID):null)})}function Ps({title:e,children:t}){return s.jsxs(xt,{border:"1px",borderColor:"gray.500",borderRadius:"md",p:4,children:[s.jsx(W,{size:"sm",mb:1,color:"GrayText",children:e}),s.jsx("div",{children:t})]})}const ae=(e,t)=>e==null?void 0:e.some(r=>r.promptKey===(t==null?void 0:t.promptKey)&&r.name===(t==null?void 0:t.name)&&r.class_type===t.classType);function Cs({media:e}){const[t,r]=l.useState([]),{curFlowID:n}=l.useContext(Z),[o,a]=l.useState(),[h,f]=l.useState(!0),[i,u]=l.useState(!0);l.useEffect(()=>{e?hn(`/workspace/view_media?filename=${e.localPath}`).then(p=>{a(p.prompt)}):re.graphToPrompt(re.graph).then(p=>{a(p.output)})},[e]),l.useEffect(()=>{if(!o)return;const p=Rt(o);r(p)},[o]);const[d,c]=l.useState([]);l.useEffect(()=>{(async()=>{var p,k;if(n){const y=(k=await((p=A)==null?void 0:p.get(n)))==null?void 0:k.topFieldsConfig;y&&(c(y),f(!1))}})()},[n]);const g=p=>{var k,y;if(ae(d,{name:p.name,promptKey:p==null?void 0:p.promptKey,classType:(p==null?void 0:p.class_type)??""})){const w=d.filter(N=>N.name!==p.name||N.promptKey!==p.promptKey);c(w),n&&((k=A)==null||k.updateTopFields(n,{topFieldsConfig:w}))}else{const w=[...d,p];c(w),n&&((y=A)==null||y.updateTopFields(n,{topFieldsConfig:w}))}};return s.jsx(de.Provider,{value:{topFields:d,showNodeName:i,calcInputList:t,updateTopField:g},children:s.jsxs(v,{direction:"column",align:"stretch",gap:5,children:[s.jsx(js,{}),s.jsxs(Y,{children:[s.jsx("p",{children:"Show all inputs"}),s.jsx(Re,{isChecked:h,onChange:p=>f(!h)}),s.jsx("p",{children:"Show node names"}),s.jsx(Re,{isChecked:i,onChange:p=>u(!i)})]}),h&&s.jsx(ks,{})]})})}const he=l.createContext({showAllImages:!1,curMedia:null,setCurMedia(){},setMediaList(){},setShowAllImages(){}}),Is=({media:e})=>{var h,f;const[t,r]=l.useState(!1),{setMediaList:n}=l.useContext(he),{loadFilePath:o}=l.useContext(Z),{showDialog:a}=ft();return l.useEffect(()=>{var i,u;r((e==null?void 0:e.localPath)!=null&&((u=(i=A)==null?void 0:i.curWorkflow)==null?void 0:u.coverMediaPath)===(e==null?void 0:e.localPath))},[e]),e?s.jsxs(v,{flexWrap:"wrap",gap:3,children:[s.jsx(v,{alignItems:"center",gap:2,children:e.localPath&&s.jsxs(s.Fragment,{children:[s.jsx(W,{children:e==null?void 0:e.localPath}),s.jsx(V,{label:"Donwload image from gallery",children:s.jsx(Me,{href:`/workspace/view_media?filename=${e==null?void 0:e.localPath}`,download:e==null?void 0:e.localPath,children:s.jsx(M,{size:"sm",icon:s.jsx(pt,{size:19}),"aria-label":"donwload image from gallery"})})})]})}),s.jsx(v,{gap:1,alignItems:"center",color:"GrayText",children:!!(e!=null&&e.createTime)&&s.jsx(W,{children:gt((e==null?void 0:e.createTime)??0,!0)})}),s.jsx(V,{label:"Remove image from gallery",children:s.jsx(M,{size:"sm",variant:"ghost",icon:s.jsx(vt,{size:19}),"aria-label":"remove image from gallery",colorScheme:"red",onClick:async()=>{var u;confirm("Are you sure to remove this image from gallery? (won't delete image on your disk)")&&(await((u=$)==null?void 0:u.delete(e.id)),n(d=>d.filter(c=>c.id!==e.id)))}})}),((f=(h=A)==null?void 0:h.curWorkflow)==null?void 0:f.id)&&s.jsx(V,{label:"Set as cover",children:s.jsx(M,{size:"sm",variant:"ghost",icon:t?s.jsx(Mt,{size:19}):s.jsx(Dt,{size:19}),"aria-label":"set as cover",onClick:async()=>{var i;await((i=A)==null?void 0:i.updateMetaInfo(A.curWorkflow.id,{coverMediaPath:t?void 0:e.localPath})),r(!t)}})}),s.jsx(mt,{onClick:()=>a("How do you want to load this workflow?",[{label:"Load in new workflow",onClick:()=>{o(e.localPath)},colorScheme:"teal"},{label:"Overwrite current workflow",onClick:()=>o(e.localPath,!0),colorScheme:"red"}]),size:"sm",children:"Load"})]}):null},Ts=({media:e})=>s.jsxs(v,{overflowY:"auto",mb:4,direction:"column",gap:2,flex:1,children:[s.jsx(Is,{media:e}),s.jsx(Cs,{media:e??null})]}),Ne=120;function Es({mediaList:e}){const{curMedia:t,setCurMedia:r}=l.useContext(he);return s.jsxs(v,{gap:3,h:"100%",children:[s.jsxs(Cn,{gridTemplateRows:e.length<=6?"1fr 20%":"1fr",flex:1,gap:2,children:[s.jsx("div",{style:{height:"56vh"},children:s.jsx(fs,{media:e.map(n=>({id:n.id,imageUrl:`/workspace/view_media?filename=${n.localPath}`})),currentNum:(e==null?void 0:e.findIndex(n=>n.id===(t==null?void 0:t.id)))??0,setMediaAct:n=>r((e==null?void 0:e.find(o=>o.id===n.id))??null)})}),s.jsx(v,{wrap:"wrap",children:e==null?void 0:e.map(n=>s.jsx(xt,{display:"inline-block",p:1,borderRadius:"4px",width:`${Ne+3}px`,height:`${Ne+3}px`,cursor:"pointer",border:(t==null?void 0:t.id)===n.id?"1px solid gray":"",onClick:()=>r(n),children:s.jsx(yt,{mediaLocalPath:n.localPath,size:Ne,objectFit:"contain",hideBrokenImage:!0,onBrokenLink:()=>{var o;(o=$)==null||o.delete(n.id)}})},`image-bottom-${n.id}`))})]}),s.jsx(Ts,{media:t??void 0})]})}const Ns=({media:e,isSelecting:t,selectedID:r,onClickMedia:n})=>{const{curFlowID:a,loadFilePath:h}=l.useContext(Z),{showDialog:f}=ft();if(e.localPath==null||a==null)return null;const i=s.jsxs(Me,{isExternal:!0,onClick:()=>n(e),position:"relative",children:[t&&s.jsx(Be,{isChecked:r.includes(e.id),position:"absolute",top:2,left:2}),s.jsx(yt,{mediaLocalPath:e.localPath,size:180,onBrokenLink:()=>{var u;(u=$)==null||u.delete(e.id)},hideBrokenImage:!0,autoPlay:!0,isPreview:!0})]});return s.jsxs(_e,{width:180,mb:2,children:[s.jsx(V,{label:gt(e.createTime,!0),children:i}),s.jsx(V,{label:e.localPath,children:s.jsx(W,{color:"GrayText",noOfLines:1,children:e.localPath})}),s.jsxs(Y,{hidden:t,gap:0,children:[s.jsx(mt,{flexGrow:1,onClick:()=>f("How do you want to load this workflow?",[{label:"Load in new workflow",onClick:()=>{h(e.localPath)},colorScheme:"teal"},{label:"Overwrite current workflow",onClick:()=>h(e.localPath,!0),colorScheme:"red"}]),size:"sm",children:"Load"}),s.jsx(V,{label:"Donwload image from gallery",children:s.jsx(Me,{href:`/workspace/view_media?filename=${e.localPath}`,download:e.localPath,children:s.jsx(M,{size:"sm",variant:"ghost",icon:s.jsx(pt,{size:19}),"aria-label":"donwload image from gallery"})})}),s.jsx(V,{label:"Remove image from gallery",children:s.jsx(M,{size:"sm",variant:"ghost",icon:s.jsx(vt,{size:19}),"aria-label":"remove image from gallery",colorScheme:"red",onClick:async()=>{var d;confirm("Are you sure to remove this image from gallery? (won't delete image on your disk)")&&await((d=$)==null?void 0:d.delete(e.id))}})})]})]})},_s=Ns;function Ms({searchQuery:e}){const[t,r]=l.useState([]),{setCurMedia:n,setShowAllImages:o,setMediaList:a}=l.useContext(he);l.useEffect(()=>{var f,i;e===""?(f=$)==null||f.listAll().then(u=>{r(u.slice(0,50)??[])}):(i=$)==null||i.filter(u=>{var d;return((d=u.workflowJSON)==null?void 0:d.includes(e))??!1}).then(u=>{r(u)})},[e]);const h=f=>{a([f].concat(t.filter(i=>i.id!==f.id))),n(f),o(!1)};return s.jsx(Y,{wrap:"wrap",children:t.map(f=>s.jsx(_s,{selectedID:[],media:f,isSelecting:!1,onClickMedia:h},f.id))})}function Us({onclose:e}){const{curFlowID:t}=l.useContext(Z),[r,n]=l.useState(""),[o,a]=l.useState([]),[h,f]=l.useState(!1),[i,u]=l.useState([]),[d,c]=l.useState(),[g,p]=l.useState(""),k=bn(g,300),[y,w]=l.useState(!1),N=async()=>{var D;if(t==null)return;const b=await((D=$)==null?void 0:D.listByWorkflowID(t));u(b??[]),b!=null&&b.length&&c(b[0])};if(l.useEffect(()=>{var b;N(),t&&((b=A)==null||b.get(t).then(D=>{D&&n(D.name)}))},[]),t==null)return null;const B=i.length>0&&o.length===i.length;return s.jsx(he.Provider,{value:{curMedia:d??null,setCurMedia:c,setMediaList:u,showAllImages:y,setShowAllImages:w},children:s.jsxs(Jt,{isOpen:!0,onClose:e,blockScrollOnMount:!0,children:[s.jsx(Qt,{}),s.jsxs(en,{width:"90%",maxWidth:"90vw",height:"90vh",children:[s.jsxs(tn,{children:[s.jsxs(Y,{gap:2,mb:2,children:[s.jsxs(fn,{size:"md",mr:2,children:["Gallery - ",r]}),s.jsx(jn,{searchValue:g,onUpdateSearchValue:b=>{p(b),y||w(!0)},placeholder:"Search prompt, model name, etc.",style:{width:"300px"}})]}),h&&s.jsxs(Y,{gap:3,children:[s.jsx(Be,{isChecked:B,onChange:()=>{a(B?[]:i.map(b=>b.id))},children:"All"}),s.jsxs(W,{fontSize:16,children:[o.length," Selected"]}),s.jsx(M,{size:"sm",icon:s.jsx(mn,{size:19}),onClick:()=>f(!1),"aria-label":"cancel"})]})]}),s.jsx(nn,{}),s.jsx(sn,{overflowY:"auto",children:y?s.jsx(Ms,{searchQuery:k}):s.jsx(Es,{mediaList:i})})]})]})})}export{Us as default};
