import{f as F,p as ht,o as he,j as s,g as E,h as Oe,r as c,d as Ie,y as qt,m as Te,b as ft,l as mt,E as Jt,W as pt,i as Ge,M as Qt,N as en,O as tn,Q as nn,R as sn,S as rn}from"./input.js";import{aj as on,a0 as an,h as He,F as w,ak as ln,al as cn,I as _,o as un,T as dn,am as hn,a7 as q,k as Re,an as xt,B as gt,l as Y,C as A,H as X,n as V,A as vt,ac as yt,i as St,a9 as $,ao as fn,G as mn}from"./App-C3wcRiQu.js";import{c as Ne,p as pn,r as lt,v as it,I as xn,N as gn,a as vn,b as yn,d as Sn,e as wn,M as wt,u as bn,S as jn}from"./MediaPreview-CCoQKqqe.js";import{S as kn}from"./chunk-3RSXBRAN-BkVx3ppk.js";import{u as Pn,C as Ue,G as Cn}from"./chunk-JARCRF6W-AaBZv7oJ.js";import{app as ce}from"/scripts/app.js";import{L as Ae,R as In,a as Tn}from"./chunk-RDF2AYID-V8_50VEk.js";import"/scripts/api.js";import"./IconSearch-DEco7Nf8.js";import"./index-DdrsuNi1.js";const bt=1/60*1e3,Nn=typeof performance<"u"?()=>performance.now():()=>Date.now(),jt=typeof window<"u"?e=>window.requestAnimationFrame(e):e=>setTimeout(()=>e(Nn()),bt);function En(e){let t=[],r=[],n=0,o=!1,l=!1;const a=new WeakSet,d={schedule:(i,u=!1,m=!1)=>{const f=m&&o,S=f?t:r;return u&&a.add(i),S.indexOf(i)===-1&&(S.push(i),f&&o&&(n=t.length)),i},cancel:i=>{const u=r.indexOf(i);u!==-1&&r.splice(u,1),a.delete(i)},process:i=>{if(o){l=!0;return}if(o=!0,[t,r]=[r,t],r.length=0,n=t.length,n)for(let u=0;u<n;u++){const m=t[u];m(i),a.has(m)&&(d.schedule(m),e())}o=!1,l&&(l=!1,d.process(i))}};return d}const Mn=40;let Fe=!0,Z=!1,Ve=!1;const B={delta:0,timestamp:0},J=["read","update","preRender","render","postRender"],fe=J.reduce((e,t)=>(e[t]=En(()=>Z=!0),e),{}),_n=J.reduce((e,t)=>{const r=fe[t];return e[t]=(n,o=!1,l=!1)=>(Z||Rn(),r.schedule(n,o,l)),e},{}),Dn=J.reduce((e,t)=>(e[t]=fe[t].cancel,e),{});J.reduce((e,t)=>(e[t]=()=>fe[t].process(B),e),{});const zn=e=>fe[e].process(B),kt=e=>{Z=!1,B.delta=Fe?bt:Math.max(Math.min(e-B.timestamp,Mn),1),B.timestamp=e,Ve=!0,J.forEach(zn),Ve=!1,Z&&(Fe=!1,jt(kt))},Rn=()=>{Z=!0,Fe=!0,Ve||jt(kt)},ct=()=>B;var Pt=F(function(t,r){const n=ht("Code",t),{className:o,...l}=he(t);return s.jsx(E.code,{ref:r,className:Oe("chakra-code",t.className),...l,__css:{display:"inline-block",...n}})});Pt.displayName="Code";var L=e=>e?"":void 0,Ee=e=>e?!0:void 0,Q=(...e)=>e.filter(Boolean).join(" ");function Me(...e){return function(r){e.some(n=>(n==null||n(r),r==null?void 0:r.defaultPrevented))}}function oe(e){const{orientation:t,vertical:r,horizontal:n}=e;return t==="vertical"?r:n}var le={width:0,height:0},ae=e=>e||le;function An(e){const{orientation:t,thumbPercents:r,thumbRects:n,isReversed:o}=e,l=g=>{var y;const k=(y=n[g])!=null?y:le;return{position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...oe({orientation:t,vertical:{bottom:`calc(${r[g]}% - ${k.height/2}px)`},horizontal:{left:`calc(${r[g]}% - ${k.width/2}px)`}})}},a=t==="vertical"?n.reduce((g,y)=>ae(g).height>ae(y).height?g:y,le):n.reduce((g,y)=>ae(g).width>ae(y).width?g:y,le),d={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0,...oe({orientation:t,vertical:a?{paddingLeft:a.width/2,paddingRight:a.width/2}:{},horizontal:a?{paddingTop:a.height/2,paddingBottom:a.height/2}:{}})},i={position:"absolute",...oe({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},u=r.length===1,m=[0,o?100-r[0]:r[0]],f=u?m:r;let S=f[0];!u&&o&&(S=100-S);const v=Math.abs(f[f.length-1]-f[0]),p={...i,...oe({orientation:t,vertical:o?{height:`${v}%`,top:`${S}%`}:{height:`${v}%`,bottom:`${S}%`},horizontal:o?{width:`${v}%`,right:`${S}%`}:{width:`${v}%`,left:`${S}%`}})};return{trackStyle:i,innerTrackStyle:p,rootStyle:d,getThumbStyle:l}}function Fn(e){const{isReversed:t,direction:r,orientation:n}=e;return r==="ltr"||n==="vertical"?t:!t}function Vn(e,t,r,n){return e.addEventListener(t,r,n),()=>{e.removeEventListener(t,r,n)}}function $n(e){const t=Bn(e);return typeof t.PointerEvent<"u"&&e instanceof t.PointerEvent?e.pointerType==="mouse":e instanceof t.MouseEvent}function Ct(e){return!!e.touches}function Ln(e){return Ct(e)&&e.touches.length>1}function Bn(e){var t;return(t=e.view)!=null?t:window}function On(e,t="page"){const r=e.touches[0]||e.changedTouches[0];return{x:r[`${t}X`],y:r[`${t}Y`]}}function Gn(e,t="page"){return{x:e[`${t}X`],y:e[`${t}Y`]}}function It(e,t="page"){return Ct(e)?On(e,t):Gn(e,t)}function Hn(e){return t=>{const r=$n(t);(!r||r&&t.button===0)&&e(t)}}function Un(e,t=!1){function r(o){e(o,{point:It(o)})}return t?Hn(r):r}function ie(e,t,r,n){return Vn(e,t,Un(r,t==="pointerdown"),n)}var Kn=Object.defineProperty,Wn=(e,t,r)=>t in e?Kn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,N=(e,t,r)=>(Wn(e,typeof t!="symbol"?t+"":t,r),r),Yn=class{constructor(e,t,r){N(this,"history",[]),N(this,"startEvent",null),N(this,"lastEvent",null),N(this,"lastEventInfo",null),N(this,"handlers",{}),N(this,"removeListeners",()=>{}),N(this,"threshold",3),N(this,"win"),N(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const d=_e(this.lastEventInfo,this.history),i=this.startEvent!==null,u=Jn(d.offset,{x:0,y:0})>=this.threshold;if(!i&&!u)return;const{timestamp:m}=ct();this.history.push({...d.point,timestamp:m});const{onStart:f,onMove:S}=this.handlers;i||(f==null||f(this.lastEvent,d),this.startEvent=this.lastEvent),S==null||S(this.lastEvent,d)}),N(this,"onPointerMove",(d,i)=>{this.lastEvent=d,this.lastEventInfo=i,_n.update(this.updatePoint,!0)}),N(this,"onPointerUp",(d,i)=>{const u=_e(i,this.history),{onEnd:m,onSessionEnd:f}=this.handlers;f==null||f(d,u),this.end(),!(!m||!this.startEvent)&&(m==null||m(d,u))});var n;if(this.win=(n=e.view)!=null?n:window,Ln(e))return;this.handlers=t,r&&(this.threshold=r),e.stopPropagation(),e.preventDefault();const o={point:It(e)},{timestamp:l}=ct();this.history=[{...o.point,timestamp:l}];const{onSessionStart:a}=t;a==null||a(e,_e(o,this.history)),this.removeListeners=qn(ie(this.win,"pointermove",this.onPointerMove),ie(this.win,"pointerup",this.onPointerUp),ie(this.win,"pointercancel",this.onPointerUp))}updateHandlers(e){this.handlers=e}end(){var e;(e=this.removeListeners)==null||e.call(this),Dn.update(this.updatePoint)}};function ut(e,t){return{x:e.x-t.x,y:e.y-t.y}}function _e(e,t){return{point:e.point,delta:ut(e.point,t[t.length-1]),offset:ut(e.point,t[0]),velocity:Zn(t,.1)}}var Xn=e=>e*1e3;function Zn(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,n=null;const o=e[e.length-1];for(;r>=0&&(n=e[r],!(o.timestamp-n.timestamp>Xn(t)));)r--;if(!n)return{x:0,y:0};const l=(o.timestamp-n.timestamp)/1e3;if(l===0)return{x:0,y:0};const a={x:(o.x-n.x)/l,y:(o.y-n.y)/l};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function qn(...e){return t=>e.reduce((r,n)=>n(r),t)}function De(e,t){return Math.abs(e-t)}function dt(e){return"x"in e&&"y"in e}function Jn(e,t){if(typeof e=="number"&&typeof t=="number")return De(e,t);if(dt(e)&&dt(t)){const r=De(e.x,t.x),n=De(e.y,t.y);return Math.sqrt(r**2+n**2)}return 0}function Tt(e){const t=c.useRef(null);return t.current=e,t}function Qn(e,t){const{onPan:r,onPanStart:n,onPanEnd:o,onPanSessionStart:l,onPanSessionEnd:a,threshold:d}=t,i=!!(r||n||o||l||a),u=c.useRef(null),m=Tt({onSessionStart:l,onSessionEnd:a,onStart:n,onMove:r,onEnd(f,S){u.current=null,o==null||o(f,S)}});c.useEffect(()=>{var f;(f=u.current)==null||f.updateHandlers(m.current)}),c.useEffect(()=>{const f=e.current;if(!f||!i)return;function S(v){u.current=new Yn(v,m.current,d)}return ie(f,"pointerdown",S)},[e,i,m,d]),c.useEffect(()=>()=>{var f;(f=u.current)==null||f.end(),u.current=null},[])}function es(e,t){if(!e){t(void 0);return}t({width:e.offsetWidth,height:e.offsetHeight});const r=e.ownerDocument.defaultView??window,n=new r.ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const[l]=o;let a,d;if("borderBoxSize"in l){const i=l.borderBoxSize,u=Array.isArray(i)?i[0]:i;a=u.inlineSize,d=u.blockSize}else a=e.offsetWidth,d=e.offsetHeight;t({width:a,height:d})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)}var ts=globalThis!=null&&globalThis.document?c.useLayoutEffect:c.useEffect;function ns(e,t){var r,n;if(!e||!e.parentElement)return;const o=(n=(r=e.ownerDocument)==null?void 0:r.defaultView)!=null?n:window,l=new o.MutationObserver(()=>{t()});return l.observe(e.parentElement,{childList:!0}),()=>{l.disconnect()}}function ss({getNodes:e,observeMutation:t=!0}){const[r,n]=c.useState([]),[o,l]=c.useState(0);return ts(()=>{const a=e(),d=a.map((i,u)=>es(i,m=>{n(f=>[...f.slice(0,u),m,...f.slice(u+1)])}));if(t){const i=a[0];d.push(ns(i,()=>{l(u=>u+1)}))}return()=>{d.forEach(i=>{i==null||i()})}},[o]),r}function rs(e){return typeof e=="object"&&e!==null&&"current"in e}function os(e){const[t]=ss({observeMutation:!1,getNodes(){return[rs(e)?e.current:e]}});return t}function as(e){var t;const{min:r=0,max:n=100,onChange:o,value:l,defaultValue:a,isReversed:d,direction:i="ltr",orientation:u="horizontal",id:m,isDisabled:f,isReadOnly:S,onChangeStart:v,onChangeEnd:p,step:g=1,getAriaValueText:y,"aria-valuetext":k,"aria-label":O,"aria-labelledby":te,name:G,focusThumbOnChange:ne=!0,...se}=e,H=Ie(v),b=Ie(p),D=Ie(y),T=Fn({isReversed:d,direction:i,orientation:u}),[Vt,ge]=on({value:l,defaultValue:a??is(r,n),onChange:o}),[ve,Ke]=c.useState(!1),[ye,We]=c.useState(!1),Se=!(f||S),we=(n-r)/10,U=g||(n-r)/100,j=Ne(Vt,r,n),$t=n-j+r,Ye=it(T?$t:j,r,n),re=u==="vertical",P=Tt({min:r,max:n,step:g,isDisabled:f,value:j,isInteractive:Se,isReversed:T,isVertical:re,eventSource:null,focusThumbOnChange:ne,orientation:u}),be=c.useRef(null),je=c.useRef(null),Xe=c.useRef(null),Lt=c.useId(),Ze=m??Lt,[qe,Je]=[`slider-thumb-${Ze}`,`slider-track-${Ze}`],Bt=c.useCallback(h=>{var x,K;if(!be.current)return;const C=P.current;C.eventSource="pointer";const M=be.current.getBoundingClientRect(),{clientX:Pe,clientY:Yt}=(K=(x=h.touches)==null?void 0:x[0])!=null?K:h,Xt=re?M.bottom-Yt:Pe-M.left,Zt=re?M.height:M.width;let Ce=Xt/Zt;T&&(Ce=1-Ce);let W=pn(Ce,C.min,C.max);return C.step&&(W=parseFloat(lt(W,C.min,C.step))),W=Ne(W,C.min,C.max),W},[re,T,P]),z=c.useCallback(h=>{const x=P.current;x.isInteractive&&(h=parseFloat(lt(h,x.min,U)),h=Ne(h,x.min,x.max),ge(h))},[U,ge,P]),R=c.useMemo(()=>({stepUp(h=U){const x=T?j-h:j+h;z(x)},stepDown(h=U){const x=T?j+h:j-h;z(x)},reset(){z(a||0)},stepTo(h){z(h)}}),[z,T,j,U,a]),Qe=c.useCallback(h=>{const x=P.current,C={ArrowRight:()=>R.stepUp(),ArrowUp:()=>R.stepUp(),ArrowLeft:()=>R.stepDown(),ArrowDown:()=>R.stepDown(),PageUp:()=>R.stepUp(we),PageDown:()=>R.stepDown(we),Home:()=>z(x.min),End:()=>z(x.max)}[h.key];C&&(h.preventDefault(),h.stopPropagation(),C(h),x.eventSource="keyboard")},[R,z,we,P]),et=(t=D==null?void 0:D(j))!=null?t:k,ke=os(je),{getThumbStyle:tt,rootStyle:nt,trackStyle:st,innerTrackStyle:rt}=c.useMemo(()=>{const h=P.current,x=ke??{width:0,height:0};return An({isReversed:T,orientation:h.orientation,thumbRects:[x],thumbPercents:[Ye]})},[T,ke,Ye,P]),ot=c.useCallback(()=>{P.current.focusThumbOnChange&&setTimeout(()=>{var x;return(x=je.current)==null?void 0:x.focus()})},[P]);qt(()=>{const h=P.current;ot(),h.eventSource==="keyboard"&&(b==null||b(h.value))},[j,b]);function at(h){const x=Bt(h);x!=null&&x!==P.current.value&&ge(x)}Qn(Xe,{onPanSessionStart(h){const x=P.current;x.isInteractive&&(Ke(!0),ot(),at(h),H==null||H(x.value))},onPanSessionEnd(){const h=P.current;h.isInteractive&&(Ke(!1),b==null||b(h.value))},onPan(h){P.current.isInteractive&&at(h)}});const Ot=c.useCallback((h={},x=null)=>({...h,...se,ref:Te(x,Xe),tabIndex:-1,"aria-disabled":Ee(f),"data-focused":L(ye),style:{...h.style,...nt}}),[se,f,ye,nt]),Gt=c.useCallback((h={},x=null)=>({...h,ref:Te(x,be),id:Je,"data-disabled":L(f),style:{...h.style,...st}}),[f,Je,st]),Ht=c.useCallback((h={},x=null)=>({...h,ref:x,style:{...h.style,...rt}}),[rt]),Ut=c.useCallback((h={},x=null)=>({...h,ref:Te(x,je),role:"slider",tabIndex:Se?0:void 0,id:qe,"data-active":L(ve),"aria-valuetext":et,"aria-valuemin":r,"aria-valuemax":n,"aria-valuenow":j,"aria-orientation":u,"aria-disabled":Ee(f),"aria-readonly":Ee(S),"aria-label":O,"aria-labelledby":O?void 0:te,style:{...h.style,...tt(0)},onKeyDown:Me(h.onKeyDown,Qe),onFocus:Me(h.onFocus,()=>We(!0)),onBlur:Me(h.onBlur,()=>We(!1))}),[Se,qe,ve,et,r,n,j,u,f,S,O,te,tt,Qe]),Kt=c.useCallback((h,x=null)=>{const K=!(h.value<r||h.value>n),C=j>=h.value,M=it(h.value,r,n),Pe={position:"absolute",pointerEvents:"none",...ls({orientation:u,vertical:{bottom:T?`${100-M}%`:`${M}%`},horizontal:{left:T?`${100-M}%`:`${M}%`}})};return{...h,ref:x,role:"presentation","aria-hidden":!0,"data-disabled":L(f),"data-invalid":L(!K),"data-highlighted":L(C),style:{...h.style,...Pe}}},[f,T,n,r,u,j]),Wt=c.useCallback((h={},x=null)=>({...h,ref:x,type:"hidden",value:j,name:G}),[G,j]);return{state:{value:j,isFocused:ye,isDragging:ve},actions:R,getRootProps:Ot,getTrackProps:Gt,getInnerTrackProps:Ht,getThumbProps:Ut,getMarkerProps:Kt,getInputProps:Wt}}function ls(e){const{orientation:t,vertical:r,horizontal:n}=e;return t==="vertical"?r:n}function is(e,t){return t<e?e:e+(t-e)/2}var[cs,me]=ft({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[us,pe]=ft({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),Nt=F((e,t)=>{var r;const n={...e,orientation:(r=e==null?void 0:e.orientation)!=null?r:"horizontal"},o=mt("Slider",n),l=he(n),{direction:a}=Jt();l.direction=a;const{getInputProps:d,getRootProps:i,...u}=as(l),m=i(),f=d({},t);return s.jsx(cs,{value:u,children:s.jsx(us,{value:o,children:s.jsxs(E.div,{...m,className:Q("chakra-slider",n.className),__css:o.container,children:[n.children,s.jsx("input",{...f})]})})})});Nt.displayName="Slider";var Et=F((e,t)=>{const{getThumbProps:r}=me(),n=pe(),o=r(e,t);return s.jsx(E.div,{...o,className:Q("chakra-slider__thumb",e.className),__css:n.thumb})});Et.displayName="SliderThumb";var Mt=F((e,t)=>{const{getTrackProps:r}=me(),n=pe(),o=r(e,t);return s.jsx(E.div,{...o,className:Q("chakra-slider__track",e.className),__css:n.track})});Mt.displayName="SliderTrack";var _t=F((e,t)=>{const{getInnerTrackProps:r}=me(),n=pe(),o=r(e,t);return s.jsx(E.div,{...o,className:Q("chakra-slider__filled-track",e.className),__css:n.filledTrack})});_t.displayName="SliderFilledTrack";var ds=F((e,t)=>{const{getMarkerProps:r}=me(),n=pe(),o=r(e,t);return s.jsx(E.div,{...o,className:Q("chakra-slider__marker",e.className),__css:n.mark})});ds.displayName="SliderMark";var $e=F(function(t,r){const n=mt("Switch",t),{spacing:o="0.5rem",children:l,...a}=he(t),{getIndicatorProps:d,getInputProps:i,getCheckboxProps:u,getRootProps:m,getLabelProps:f}=Pn(a),S=c.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...n.container}),[n.container]),v=c.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...n.track}),[n.track]),p=c.useMemo(()=>({userSelect:"none",marginStart:o,...n.label}),[o,n.label]);return s.jsxs(E.label,{...m(),className:Oe("chakra-switch",t.className),__css:S,children:[s.jsx("input",{className:"chakra-switch__input",...i({},r)}),s.jsx(E.span,{...u(),className:"chakra-switch__track",__css:v,children:s.jsx(E.span,{__css:n.thumb,className:"chakra-switch__thumb",...d()})}),l&&s.jsx(E.span,{className:"chakra-switch__label",...f(),__css:p,children:l})]})});$e.displayName="Switch";function hs(e,t=[]){const r=Object.assign({},e);for(const n of t)n in r&&delete r[n];return r}var fs=["h","minH","height","minHeight"],Dt=F((e,t)=>{const r=ht("Textarea",e),{className:n,rows:o,...l}=he(e),a=an(l),d=o?hs(r,fs):r;return s.jsx(E.textarea,{ref:t,rows:o,...a,className:Oe("chakra-textarea",n),__css:d})});Dt.displayName="Textarea";var ms=He("chevron-left","IconChevronLeft",[["path",{d:"M15 6l-6 6l6 6",key:"svg-0"}]]),zt=He("pin-filled","IconPinFilled",[["path",{d:"M15.113 3.21l.094 .083l5.5 5.5a1 1 0 0 1 -1.175 1.59l-3.172 3.171l-1.424 3.797a1 1 0 0 1 -.158 .277l-.07 .08l-1.5 1.5a1 1 0 0 1 -1.32 .082l-.095 -.083l-2.793 -2.792l-3.793 3.792a1 1 0 0 1 -1.497 -1.32l.083 -.094l3.792 -3.793l-2.792 -2.793a1 1 0 0 1 -.083 -1.32l.083 -.094l1.5 -1.5a1 1 0 0 1 .258 -.187l.098 -.042l3.796 -1.425l3.171 -3.17a1 1 0 0 1 1.497 -1.26z",fill:"currentColor",key:"svg-0",strokeWidth:"0"}]]),Rt=He("pin","IconPin",[["path",{d:"M15 4.5l-4 4l-4 1.5l-1.5 1.5l7 7l1.5 -1.5l1.5 -4l4 -4",key:"svg-0"}],["path",{d:"M9 15l-4.5 4.5",key:"svg-1"}],["path",{d:"M14.5 4l5.5 5.5",key:"svg-2"}]]);const ps=({setMediaAct:e,media:t,currentNum:r})=>{const n=a=>{const d=(r+a+t.length)%t.length;e&&e(t[d])},o={width:"100%",height:"100%"};if(t.length===0)return s.jsx("p",{children:"No images found, let's start generating 🪄"});const l=t.at(r);return l?s.jsxs(w,{justifyContent:"center",alignItems:"center",position:"relative",width:o.width,height:o.height,overflow:"hidden",children:[s.jsx("div",{style:{position:"absolute",cursor:"pointer",width:"100%",height:"100%"},onClick:()=>{window.open(l.imageUrl)},children:ln(l.imageUrl)?s.jsx(cn,{src:l.imageUrl,alt:`image-${l.id}`,width:"100%",height:"100%",objectFit:"contain"}):s.jsx("video",{style:{objectFit:"contain"},width:"100%",height:"100%",src:l.imageUrl,loop:!0,autoPlay:!0,muted:!0,children:s.jsx("track",{kind:"captions"})})},l.id),s.jsx(_,{size:"sm",color:"white",bgColor:"whiteAlpha.400","aria-label":"Previous image",icon:s.jsx(ms,{}),onClick:()=>n(-1),position:"absolute",left:"0",zIndex:"2"}),s.jsx(_,{size:"sm",color:"white",bgColor:"whiteAlpha.400","aria-label":"Next image",icon:s.jsx(xn,{}),onClick:()=>n(1),position:"absolute",right:"0",zIndex:"2"})]}):null},xs=({inputItem:e})=>s.jsxs(w,{gap:2,children:[s.jsx(w,{gap:1,alignItems:"center",flexBasis:"200px",children:e.label??e.inputName}),s.jsx(un,{value:e.inputValue,onChange:t=>{}})]}),gs=e=>{const t=e.inputItem;return s.jsxs(w,{gap:1,direction:"column",children:[s.jsxs(w,{gap:2,children:[s.jsx(w,{gap:1,alignItems:"center",flexBasis:"200px",children:t.label??t.inputName}),s.jsxs(gn,{width:"100%",step:e==null?void 0:e.step,value:t.inputValue,min:e==null?void 0:e.min,max:e==null?void 0:e.max,onChange:r=>{},children:[s.jsx(vn,{}),s.jsxs(yn,{children:[s.jsx(Sn,{}),s.jsx(wn,{})]})]})]}),s.jsx(w,{children:s.jsxs(Nt,{maxWidth:"400px",step:e==null?void 0:e.step,value:Number(t.inputValue),min:(e==null?void 0:e.min)??0,max:(e==null?void 0:e.max)??100,onChange:r=>{},children:[s.jsx(Mt,{children:s.jsx(_t,{})}),s.jsx(Et,{})]})})]})},vs=e=>{var r;const{inputItem:t}=e;return s.jsxs(w,{gap:2,children:[s.jsx(w,{gap:1,alignItems:"center",flexBasis:"200px",children:t.label??t.inputName}),s.jsx(kn,{value:t.inputValue,onChange:n=>{},children:(r=e==null?void 0:e.options)==null?void 0:r.map((n,o)=>s.jsx("option",{value:n,children:n},`select${t.nodeID}${t.inputName}${o}`))})]})},ys=e=>{const t=e.inputItem;return s.jsxs(w,{gap:1,direction:"column",children:[s.jsx(w,{children:t.label??t.inputName}),s.jsx(Dt,{value:t.inputValue,onChange:r=>{},rows:5})]})};var I=(e=>(e.Input="Input",e.InputSlider="InputSlider",e.Select="Select",e.Textarea="Textarea",e.Checkbox="Checkbox",e.NoSupport="NoSupport",e))(I||{});const Ss=e=>s.jsxs(w,{gap:2,children:[s.jsx(w,{gap:1,alignItems:"center",flexBasis:"200px",children:e.inputItem.label??e.inputItem.inputName}),s.jsx(w,{children:"No Support"})]}),ws=e=>{const t=e.inputItem;return s.jsxs(w,{gap:2,children:[s.jsx(w,{gap:1,alignItems:"center",flexBasis:"200px",children:t.label??t.inputName}),s.jsx(Ue,{defaultChecked:!!t.inputValue,onChange:r=>{var n;(n=e==null?void 0:e.updateMetaData)==null||n.call(e,{promptKey:e.promptKey,name:e.name,value:r.target.checked})}})]})},xe=c.createContext({topFields:[],calcInputList:[],showNodeName:!1,updateTopField(){}}),bs={[I.Input]:xs,[I.InputSlider]:gs,[I.Select]:vs,[I.Textarea]:ys,[I.Checkbox]:ws,NoSupport:Ss},js=LiteGraph.registered_node_types;function ks(e,t){var o,l,a,d,i;const r=(o=js[e])==null?void 0:o.nodeData,n={...((l=r==null?void 0:r.input)==null?void 0:l.required)??{},...((a=r==null?void 0:r.input)==null?void 0:a.optional)??{}}[t];return(n==null?void 0:n[0])==="STRING"?(d=n==null?void 0:n[1])!=null&&d.multiline?{type:I.Textarea}:{type:I.Input}:(n==null?void 0:n[0])==="BOOLEAN"?{type:I.Checkbox}:(n==null?void 0:n[0])==="FLOAT"?{...(n==null?void 0:n[1])??{},type:I.InputSlider}:(n==null?void 0:n[0])==="INT"?{...(n==null?void 0:n[1])??{},type:I.InputSlider}:Array.isArray(n==null?void 0:n[0])&&((i=n==null?void 0:n[0])!=null&&i.every(u=>typeof u=="string"))?{options:n==null?void 0:n[0],type:I.Select}:{type:I.NoSupport}}const Le=({inputItem:e,diffMode:t,selectedDiffName:r})=>{const n=ks(e.classType,e.inputName),[o,l]=c.useState(!1),a=bs[n.type??"Input"],{updateTopField:d,topFields:i}=c.useContext(xe),u=e.children[0]==="negative"||e.children[0]==="positive"?`-${e.children[0]}`:"",m={...e,label:e.label??e.inputName+u};return s.jsxs(w,{alignItems:"center",onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:[s.jsx(_,{size:"xs",onClick:()=>d==null?void 0:d({name:e.inputName,promptKey:e.nodeID,class_type:e.classType}),variant:"ghost",icon:de(i,{name:e.inputName,promptKey:e.nodeID,classType:e.classType})?s.jsx(zt,{size:14}):s.jsx(Rt,{size:14}),"aria-label":"pin"}),s.jsxs("div",{style:{flex:1},children:[s.jsx(a,{inputItem:m,...n}),e.latestInputVal!==void 0?s.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[s.jsx(dn,{size:"sm",variant:"outline",colorScheme:"blue",children:s.jsx(hn,{children:t==="select"?r:"LATEST"})}),s.jsx(Pt,{style:{flex:1,maxHeight:"80px",overflow:"auto"},colorScheme:"yellow",children:e.latestInputVal})]}):null]})]})};function Ps(){const{topFields:e,updateTopField:t,calcInputList:r}=c.useContext(xe);return e.length===0?null:s.jsx(s.Fragment,{children:s.jsx(w,{px:2,gap:2,direction:"column",children:e==null?void 0:e.map(n=>{const o=r.find(l=>l.nodeID==n.promptKey&&l.inputName===n.name&&l.classType===n.class_type);return!n.class_type||!o?null:s.jsx(Le,{inputItem:o},`formTopField${n.promptKey}${n.name}`)})})})}let ue=[],Be=new Set;function At(e,t){if(!Be.has(e.nodeID))return Be.add(e.nodeID),Object.entries(e.inputs).forEach(([r,n])=>{if(Array.isArray(n)){const o=n[0];At(t[o],t)}}),Object.entries(e.inputs).forEach(([r,n])=>{Array.isArray(n)||ue.push({classType:e.class_type,inputName:r,inputValue:n,nodeID:e.nodeID,children:e.children||[]})}),ue}function Ft(e){ue=[],Be=new Set;for(const t of Object.keys(e))e[t].nodeID=t,Object.entries(e[t].inputs).forEach(([r,n])=>{if(Array.isArray(n)){const o=n[0],l=e[o];l.children||(l.children=[]),l.children.push(r)}});for(const t of Object.keys(e))At(e[t],e);return ue}const ee=c.createContext({showAllImages:!1,curMedia:null,setCurMedia(){},setMediaList(){},setShowAllImages(){},setDiffMode(){},diffMode:"latest",setDiffImgSrc(){},diffImgSrc:void 0});function Cs(){const{topFields:e,calcInputList:t,showNodeName:r}=c.useContext(xe),{curFlowID:n}=c.useContext(q),o=c.useCallback(p=>{const g=[];return p.forEach(y=>{const k=g[g.length-1];!k||k[0].nodeID!==y.nodeID||k[0].classType!==y.classType?g.push([y]):k.push(y)}),g},[]),{diffMode:l,diffImgSrc:a}=c.useContext(ee),[d,i]=c.useState([]),[u,m]=c.useState();c.useEffect(()=>{if(!u)return;const p=Ft(u);i(p)},[u]);async function f(){return ce.graphToPrompt(ce.graph).then(p=>{m(p.output)})}async function S(p){const{prompt:g}=await xt("/workspace/view_media?filename="+p);m(g)}if(c.useEffect(()=>{a?S(a):n&&f()},[n,a]),c.useEffect(()=>{t.forEach((p,g)=>{const y=d[g];y&&p.nodeID===y.nodeID&&p.inputName===y.inputName&&y.inputValue!==p.inputValue?p.latestInputVal=y.inputValue:p.latestInputVal=void 0}),console.log("calcInputList diff",t)},[d,t]),!r)return s.jsx(Re,{children:t.map((p,g)=>de(e,{name:p.inputName,promptKey:p.nodeID,classType:p.classType})?null:s.jsx(Le,{inputItem:p,diffMode:l,selectedDiffName:a},`form${p.nodeID}${p.inputName}`))});const v=o(t);return s.jsx(Re,{children:v.map(p=>p[0]?s.jsx(Is,{title:p[0].classType+" #"+p[0].nodeID,children:s.jsx(w,{px:2,gap:1,direction:"column",children:p.map(g=>de(e,{name:g.inputName,promptKey:g.nodeID,classType:g.classType})?null:s.jsx(Le,{inputItem:g,diffMode:l,selectedDiffName:a},`form${g.nodeID}${g.inputName}`))})},p[0].nodeID):null)})}function Is({title:e,children:t}){return s.jsxs(gt,{border:"1px",borderColor:"gray.500",borderRadius:"md",p:4,children:[s.jsx(Y,{size:"sm",mb:1,color:"GrayText",children:e}),s.jsx("div",{children:t})]})}const de=(e,t)=>e==null?void 0:e.some(r=>r.promptKey===(t==null?void 0:t.promptKey)&&r.name===(t==null?void 0:t.name)&&r.class_type===t.classType);function Ts({media:e}){const[t,r]=c.useState([]),{curFlowID:n}=c.useContext(q),[o,l]=c.useState(),[a,d]=c.useState(!0),[i,u]=c.useState(!0);c.useEffect(()=>{e?xt(`/workspace/view_media?filename=${e.localPath}`).then(v=>{l(v.prompt)}):ce.graphToPrompt(ce.graph).then(v=>{l(v.output)})},[e]),c.useEffect(()=>{if(!o)return;const v=Ft(o);r(v)},[o]);const[m,f]=c.useState([]);c.useEffect(()=>{(async()=>{var v,p;if(n){const g=(p=await((v=A)==null?void 0:v.get(n)))==null?void 0:p.topFieldsConfig;g&&(f(g),d(!1))}})()},[n]);const S=v=>{var p,g;if(de(m,{name:v.name,promptKey:v==null?void 0:v.promptKey,classType:(v==null?void 0:v.class_type)??""})){const y=m.filter(k=>k.name!==v.name||k.promptKey!==v.promptKey);f(y),n&&((p=A)==null||p.updateTopFields(n,{topFieldsConfig:y}))}else{const y=[...m,v];f(y),n&&((g=A)==null||g.updateTopFields(n,{topFieldsConfig:y}))}};return s.jsx(xe.Provider,{value:{topFields:m,showNodeName:i,calcInputList:t,updateTopField:S},children:s.jsxs(w,{direction:"column",align:"stretch",gap:5,children:[s.jsx(Ps,{}),s.jsxs(X,{children:[s.jsx("p",{children:"Show all inputs"}),s.jsx($e,{isChecked:a,onChange:v=>d(!a)}),s.jsx("p",{children:"Show node names"}),s.jsx($e,{isChecked:i,onChange:v=>u(!i)})]}),a&&s.jsx(Cs,{})]})})}const Ns=({media:e})=>{var a,d;const[t,r]=c.useState(!1),{setMediaList:n}=c.useContext(ee),{loadFilePath:o}=c.useContext(q),{showDialog:l}=pt();return c.useEffect(()=>{var i,u;r((e==null?void 0:e.localPath)!=null&&((u=(i=A)==null?void 0:i.curWorkflow)==null?void 0:u.coverMediaPath)===(e==null?void 0:e.localPath))},[e]),e?s.jsxs(w,{flexWrap:"wrap",gap:3,children:[s.jsx(w,{alignItems:"center",gap:2,children:e.localPath&&s.jsxs(s.Fragment,{children:[s.jsx(Y,{children:e==null?void 0:e.localPath}),s.jsx(V,{label:"Donwload image from gallery",children:s.jsx(Ae,{href:`/workspace/view_media?filename=${e==null?void 0:e.localPath}`,download:e==null?void 0:e.localPath,children:s.jsx(_,{size:"sm",icon:s.jsx(vt,{size:19}),"aria-label":"donwload image from gallery"})})})]})}),s.jsx(w,{gap:1,alignItems:"center",color:"GrayText",children:!!(e!=null&&e.createTime)&&s.jsx(Y,{children:yt((e==null?void 0:e.createTime)??0,!0)})}),s.jsx(V,{label:"Remove image from gallery",children:s.jsx(_,{size:"sm",variant:"ghost",icon:s.jsx(St,{size:19}),"aria-label":"remove image from gallery",colorScheme:"red",onClick:async()=>{var u;confirm("Are you sure to remove this image from gallery? (won't delete image on your disk)")&&(await((u=$)==null?void 0:u.delete(e.id)),n(m=>m.filter(f=>f.id!==e.id)))}})}),((d=(a=A)==null?void 0:a.curWorkflow)==null?void 0:d.id)&&s.jsx(V,{label:"Set as cover",children:s.jsx(_,{size:"sm",variant:"ghost",icon:t?s.jsx(zt,{size:19}):s.jsx(Rt,{size:19}),"aria-label":"set as cover",onClick:async()=>{var i;await((i=A)==null?void 0:i.updateMetaInfo(A.curWorkflow.id,{coverMediaPath:t?void 0:e.localPath})),r(!t)}})}),s.jsx(Ge,{onClick:()=>l("How do you want to load this workflow?",[{label:"Load in new workflow",onClick:()=>{o(e.localPath)},colorScheme:"teal"},{label:"Overwrite current workflow",onClick:()=>o(e.localPath,!0),colorScheme:"red"}]),size:"sm",children:"Load"})]}):null},Es=({media:e})=>s.jsxs(w,{overflowY:"auto",mb:4,direction:"column",gap:2,flex:1,children:[s.jsx(Ns,{media:e}),s.jsx(Ts,{media:e??null})]}),ze=120;function Ms({mediaList:e}){const{curMedia:t,setCurMedia:r,diffMode:n,setDiffImgSrc:o,diffImgSrc:l}=c.useContext(ee);return s.jsxs(w,{gap:3,h:"100%",children:[s.jsxs(Cn,{gridTemplateRows:e.length<=6?"1fr 20%":"1fr",flex:1,gap:2,children:[s.jsx("div",{style:{height:"56vh"},children:s.jsx(ps,{media:e.map(a=>({id:a.id,imageUrl:`/workspace/view_media?filename=${a.localPath}`})),currentNum:(e==null?void 0:e.findIndex(a=>a.id===(t==null?void 0:t.id)))??0,setMediaAct:a=>r((e==null?void 0:e.find(d=>d.id===a.id))??null)})}),s.jsx(w,{wrap:"wrap",children:s.jsx(In,{onChange:o,value:l,children:e==null?void 0:e.map(a=>s.jsxs(gt,{display:"inline-block",style:{position:"relative"},p:1,borderRadius:"4px",width:`${ze+3}px`,height:`${ze+3}px`,cursor:"pointer",border:(t==null?void 0:t.id)===a.id?"1px solid gray":"",onClick:()=>r(a),children:[n==="select"?s.jsx("div",{onClick:d=>d.stopPropagation(),style:{position:"absolute",right:"10px",top:"10px"},children:s.jsx(Tn,{colorScheme:"red",size:"lg",value:a.localPath,isDisabled:(t==null?void 0:t.localPath)===a.localPath})}):null,s.jsx(wt,{mediaLocalPath:a.localPath,size:ze,objectFit:"contain",hideBrokenImage:!0,onBrokenLink:()=>{var d;(d=$)==null||d.delete(a.id)}})]},`image-bottom-${a.id}`))})})]}),s.jsx(Es,{media:t??void 0})]})}const _s=({media:e,isSelecting:t,selectedID:r,onClickMedia:n})=>{const{curFlowID:l,loadFilePath:a}=c.useContext(q),{showDialog:d}=pt();if(e.localPath==null||l==null)return null;const i=s.jsxs(Ae,{isExternal:!0,onClick:()=>n(e),position:"relative",children:[t&&s.jsx(Ue,{isChecked:r.includes(e.id),position:"absolute",top:2,left:2}),s.jsx(wt,{mediaLocalPath:e.localPath,size:180,onBrokenLink:()=>{var u;(u=$)==null||u.delete(e.id)},hideBrokenImage:!0,autoPlay:!0,isPreview:!0})]});return s.jsxs(Re,{width:180,mb:2,children:[s.jsx(V,{label:yt(e.createTime,!0),children:i}),s.jsx(V,{label:e.localPath,children:s.jsx(Y,{color:"GrayText",noOfLines:1,children:e.localPath})}),s.jsxs(X,{hidden:t,gap:0,children:[s.jsx(Ge,{flexGrow:1,onClick:()=>d("How do you want to load this workflow?",[{label:"Load in new workflow",onClick:()=>{a(e.localPath)},colorScheme:"teal"},{label:"Overwrite current workflow",onClick:()=>a(e.localPath,!0),colorScheme:"red"}]),size:"sm",children:"Load"}),s.jsx(V,{label:"Donwload image from gallery",children:s.jsx(Ae,{href:`/workspace/view_media?filename=${e.localPath}`,download:e.localPath,children:s.jsx(_,{size:"sm",variant:"ghost",icon:s.jsx(vt,{size:19}),"aria-label":"donwload image from gallery"})})}),s.jsx(V,{label:"Remove image from gallery",children:s.jsx(_,{size:"sm",variant:"ghost",icon:s.jsx(St,{size:19}),"aria-label":"remove image from gallery",colorScheme:"red",onClick:async()=>{var m;confirm("Are you sure to remove this image from gallery? (won't delete image on your disk)")&&await((m=$)==null?void 0:m.delete(e.id))}})})]})]})},Ds=_s;function zs({searchQuery:e}){const[t,r]=c.useState([]),{setCurMedia:n,setShowAllImages:o,setMediaList:l,diffMode:a}=c.useContext(ee);c.useEffect(()=>{var i,u;e===""?(i=$)==null||i.listAll().then(m=>{r(m.slice(0,50)??[])}):(u=$)==null||u.filter(m=>{var f;return((f=m.workflowJSON)==null?void 0:f.includes(e))??!1}).then(m=>{r(m)})},[e]);const d=i=>{l([i].concat(t.filter(u=>u.id!==i.id))),n(i),o(!1)};return s.jsx(X,{wrap:"wrap",children:t.map(i=>s.jsx(Ds,{selectedID:[],media:i,isSelecting:!1,onClickMedia:d},i.id))})}function Ws({onclose:e}){const{curFlowID:t}=c.useContext(q),[r,n]=c.useState(""),[o,l]=c.useState([]),[a,d]=c.useState(!1),[i,u]=c.useState([]),[m,f]=c.useState(),[S,v]=c.useState(""),p=bn(S,300),[g,y]=c.useState(!1),[k,O]=c.useState("latest"),[te,G]=c.useState(),ne=b=>{O(b),b==="select"&&G(void 0)},se=async()=>{var D;if(t==null)return;const b=await((D=$)==null?void 0:D.listByWorkflowID(t));u(b??[]),b!=null&&b.length&&f(b[0])};if(c.useEffect(()=>{var b;se(),t&&((b=A)==null||b.get(t).then(D=>{D&&n(D.name)}))},[]),t==null)return null;const H=i.length>0&&o.length===i.length;return s.jsx(ee.Provider,{value:{curMedia:m??null,setCurMedia:f,setMediaList:u,showAllImages:g,setShowAllImages:y,diffMode:k,setDiffMode:ne,diffImgSrc:te,setDiffImgSrc:G},children:s.jsxs(Qt,{isOpen:!0,onClose:e,blockScrollOnMount:!0,children:[s.jsx(en,{}),s.jsxs(tn,{width:"90%",maxWidth:"90vw",height:"90vh",children:[s.jsxs(nn,{children:[s.jsxs(X,{gap:2,mb:2,children:[s.jsxs(fn,{size:"md",mr:2,children:["Gallery - ",r]}),s.jsx(jn,{searchValue:S,onUpdateSearchValue:b=>{v(b),g||y(!0)},placeholder:"Search prompt, model name, etc.",style:{width:"300px"}}),s.jsx(Ge,{onClick:()=>ne(k==="latest"?"select":"latest"),size:"sm",children:k==="latest"?"Select Diff":"Diff Latest"})]}),a&&s.jsxs(X,{gap:3,children:[s.jsx(Ue,{isChecked:H,onChange:()=>{l(H?[]:i.map(b=>b.id))},children:"All"}),s.jsxs(Y,{fontSize:16,children:[o.length," Selected"]}),s.jsx(_,{size:"sm",icon:s.jsx(mn,{size:19}),onClick:()=>d(!1),"aria-label":"cancel"})]})]}),s.jsx(sn,{}),s.jsx(rn,{overflowY:"auto",children:g?s.jsx(zs,{searchQuery:p}):s.jsx(Ms,{mediaList:i})})]})]})})}export{Ws as default};
