import{f as z,p as dt,o as ie,j as r,g as _,h as $e,r as l,d as ke,y as Ht,m as Pe,b as ht,l as ft,E as Kt,W as Wt,i as Yt,M as Xt,N as Zt,O as qt,Q as Jt,R as Qt,S as en}from"./input.js";import{aj as tn,a0 as nn,h as Be,F as v,ak as sn,al as rn,I as A,o as an,T as on,am as ln,a7 as ce,k as Me,B as mt,l as $,an as cn,C as ne,H as Y,n as W,A as pt,ac as xt,a9 as L,i as un,ao as dn,G as hn}from"./App-dzklybOj.js";import{c as Ce,p as fn,r as ot,v as lt,I as mn,N as pn,a as xn,b as gn,d as vn,e as yn,M as gt,u as Sn,S as bn}from"./MediaPreview-tuZG6fD1.js";import{S as wn}from"./chunk-3RSXBRAN-CztnybgQ.js";import{u as jn,C as Le,G as kn}from"./chunk-JARCRF6W-BQ1UJwy8.js";import{app as ae}from"/scripts/app.js";import{L as De}from"./chunk-K7XRJ7NL-BL_zx934.js";import"/scripts/api.js";import"./IconSearch-DGMNFZQw.js";import"./index-DdrsuNi1.js";const vt=1/60*1e3,Pn=typeof performance<"u"?()=>performance.now():()=>Date.now(),yt=typeof window<"u"?e=>window.requestAnimationFrame(e):e=>setTimeout(()=>e(Pn()),vt);function Cn(e){let t=[],s=[],n=0,a=!1,o=!1;const u=new WeakSet,d={schedule:(m,h=!1,i=!1)=>{const c=i&&a,g=c?t:s;return h&&u.add(m),g.indexOf(m)===-1&&(g.push(m),c&&a&&(n=t.length)),m},cancel:m=>{const h=s.indexOf(m);h!==-1&&s.splice(h,1),u.delete(m)},process:m=>{if(a){o=!0;return}if(a=!0,[t,s]=[s,t],s.length=0,n=t.length,n)for(let h=0;h<n;h++){const i=t[h];i(m),u.has(i)&&(d.schedule(i),e())}a=!1,o&&(o=!1,d.process(m))}};return d}const In=40;let Re=!0,X=!1,ze=!1;const B={delta:0,timestamp:0},Z=["read","update","preRender","render","postRender"],ue=Z.reduce((e,t)=>(e[t]=Cn(()=>X=!0),e),{}),Tn=Z.reduce((e,t)=>{const s=ue[t];return e[t]=(n,a=!1,o=!1)=>(X||_n(),s.schedule(n,a,o)),e},{}),Nn=Z.reduce((e,t)=>(e[t]=ue[t].cancel,e),{});Z.reduce((e,t)=>(e[t]=()=>ue[t].process(B),e),{});const En=e=>ue[e].process(B),St=e=>{X=!1,B.delta=Re?vt:Math.max(Math.min(e-B.timestamp,In),1),B.timestamp=e,ze=!0,Z.forEach(En),ze=!1,X&&(Re=!1,yt(St))},_n=()=>{X=!0,Re=!0,ze||yt(St)},it=()=>B;var bt=z(function(t,s){const n=dt("Code",t),{className:a,...o}=ie(t);return r.jsx(_.code,{ref:s,className:$e("chakra-code",t.className),...o,__css:{display:"inline-block",...n}})});bt.displayName="Code";var V=e=>e?"":void 0,Ie=e=>e?!0:void 0,q=(...e)=>e.filter(Boolean).join(" ");function Te(...e){return function(s){e.some(n=>(n==null||n(s),s==null?void 0:s.defaultPrevented))}}function ee(e){const{orientation:t,vertical:s,horizontal:n}=e;return t==="vertical"?s:n}var se={width:0,height:0},te=e=>e||se;function Mn(e){const{orientation:t,thumbPercents:s,thumbRects:n,isReversed:a}=e,o=y=>{var S;const N=(S=n[y])!=null?S:se;return{position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...ee({orientation:t,vertical:{bottom:`calc(${s[y]}% - ${N.height/2}px)`},horizontal:{left:`calc(${s[y]}% - ${N.width/2}px)`}})}},u=t==="vertical"?n.reduce((y,S)=>te(y).height>te(S).height?y:S,se):n.reduce((y,S)=>te(y).width>te(S).width?y:S,se),d={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0,...ee({orientation:t,vertical:u?{paddingLeft:u.width/2,paddingRight:u.width/2}:{},horizontal:u?{paddingTop:u.height/2,paddingBottom:u.height/2}:{}})},m={position:"absolute",...ee({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},h=s.length===1,i=[0,a?100-s[0]:s[0]],c=h?i:s;let g=c[0];!h&&a&&(g=100-g);const p=Math.abs(c[c.length-1]-c[0]),j={...m,...ee({orientation:t,vertical:a?{height:`${p}%`,top:`${g}%`}:{height:`${p}%`,bottom:`${g}%`},horizontal:a?{width:`${p}%`,right:`${g}%`}:{width:`${p}%`,left:`${g}%`}})};return{trackStyle:m,innerTrackStyle:j,rootStyle:d,getThumbStyle:o}}function Dn(e){const{isReversed:t,direction:s,orientation:n}=e;return s==="ltr"||n==="vertical"?t:!t}function Rn(e,t,s,n){return e.addEventListener(t,s,n),()=>{e.removeEventListener(t,s,n)}}function zn(e){const t=Fn(e);return typeof t.PointerEvent<"u"&&e instanceof t.PointerEvent?e.pointerType==="mouse":e instanceof t.MouseEvent}function wt(e){return!!e.touches}function An(e){return wt(e)&&e.touches.length>1}function Fn(e){var t;return(t=e.view)!=null?t:window}function Vn(e,t="page"){const s=e.touches[0]||e.changedTouches[0];return{x:s[`${t}X`],y:s[`${t}Y`]}}function $n(e,t="page"){return{x:e[`${t}X`],y:e[`${t}Y`]}}function jt(e,t="page"){return wt(e)?Vn(e,t):$n(e,t)}function Bn(e){return t=>{const s=zn(t);(!s||s&&t.button===0)&&e(t)}}function Ln(e,t=!1){function s(a){e(a,{point:jt(a)})}return t?Bn(s):s}function re(e,t,s,n){return Rn(e,t,Ln(s,t==="pointerdown"),n)}var On=Object.defineProperty,Gn=(e,t,s)=>t in e?On(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,E=(e,t,s)=>(Gn(e,typeof t!="symbol"?t+"":t,s),s),Un=class{constructor(e,t,s){E(this,"history",[]),E(this,"startEvent",null),E(this,"lastEvent",null),E(this,"lastEventInfo",null),E(this,"handlers",{}),E(this,"removeListeners",()=>{}),E(this,"threshold",3),E(this,"win"),E(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const d=Ne(this.lastEventInfo,this.history),m=this.startEvent!==null,h=Yn(d.offset,{x:0,y:0})>=this.threshold;if(!m&&!h)return;const{timestamp:i}=it();this.history.push({...d.point,timestamp:i});const{onStart:c,onMove:g}=this.handlers;m||(c==null||c(this.lastEvent,d),this.startEvent=this.lastEvent),g==null||g(this.lastEvent,d)}),E(this,"onPointerMove",(d,m)=>{this.lastEvent=d,this.lastEventInfo=m,Tn.update(this.updatePoint,!0)}),E(this,"onPointerUp",(d,m)=>{const h=Ne(m,this.history),{onEnd:i,onSessionEnd:c}=this.handlers;c==null||c(d,h),this.end(),!(!i||!this.startEvent)&&(i==null||i(d,h))});var n;if(this.win=(n=e.view)!=null?n:window,An(e))return;this.handlers=t,s&&(this.threshold=s),e.stopPropagation(),e.preventDefault();const a={point:jt(e)},{timestamp:o}=it();this.history=[{...a.point,timestamp:o}];const{onSessionStart:u}=t;u==null||u(e,Ne(a,this.history)),this.removeListeners=Wn(re(this.win,"pointermove",this.onPointerMove),re(this.win,"pointerup",this.onPointerUp),re(this.win,"pointercancel",this.onPointerUp))}updateHandlers(e){this.handlers=e}end(){var e;(e=this.removeListeners)==null||e.call(this),Nn.update(this.updatePoint)}};function ct(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Ne(e,t){return{point:e.point,delta:ct(e.point,t[t.length-1]),offset:ct(e.point,t[0]),velocity:Kn(t,.1)}}var Hn=e=>e*1e3;function Kn(e,t){if(e.length<2)return{x:0,y:0};let s=e.length-1,n=null;const a=e[e.length-1];for(;s>=0&&(n=e[s],!(a.timestamp-n.timestamp>Hn(t)));)s--;if(!n)return{x:0,y:0};const o=(a.timestamp-n.timestamp)/1e3;if(o===0)return{x:0,y:0};const u={x:(a.x-n.x)/o,y:(a.y-n.y)/o};return u.x===1/0&&(u.x=0),u.y===1/0&&(u.y=0),u}function Wn(...e){return t=>e.reduce((s,n)=>n(s),t)}function Ee(e,t){return Math.abs(e-t)}function ut(e){return"x"in e&&"y"in e}function Yn(e,t){if(typeof e=="number"&&typeof t=="number")return Ee(e,t);if(ut(e)&&ut(t)){const s=Ee(e.x,t.x),n=Ee(e.y,t.y);return Math.sqrt(s**2+n**2)}return 0}function kt(e){const t=l.useRef(null);return t.current=e,t}function Xn(e,t){const{onPan:s,onPanStart:n,onPanEnd:a,onPanSessionStart:o,onPanSessionEnd:u,threshold:d}=t,m=!!(s||n||a||o||u),h=l.useRef(null),i=kt({onSessionStart:o,onSessionEnd:u,onStart:n,onMove:s,onEnd(c,g){h.current=null,a==null||a(c,g)}});l.useEffect(()=>{var c;(c=h.current)==null||c.updateHandlers(i.current)}),l.useEffect(()=>{const c=e.current;if(!c||!m)return;function g(p){h.current=new Un(p,i.current,d)}return re(c,"pointerdown",g)},[e,m,i,d]),l.useEffect(()=>()=>{var c;(c=h.current)==null||c.end(),h.current=null},[])}function Zn(e,t){if(!e){t(void 0);return}t({width:e.offsetWidth,height:e.offsetHeight});const s=e.ownerDocument.defaultView??window,n=new s.ResizeObserver(a=>{if(!Array.isArray(a)||!a.length)return;const[o]=a;let u,d;if("borderBoxSize"in o){const m=o.borderBoxSize,h=Array.isArray(m)?m[0]:m;u=h.inlineSize,d=h.blockSize}else u=e.offsetWidth,d=e.offsetHeight;t({width:u,height:d})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)}var qn=globalThis!=null&&globalThis.document?l.useLayoutEffect:l.useEffect;function Jn(e,t){var s,n;if(!e||!e.parentElement)return;const a=(n=(s=e.ownerDocument)==null?void 0:s.defaultView)!=null?n:window,o=new a.MutationObserver(()=>{t()});return o.observe(e.parentElement,{childList:!0}),()=>{o.disconnect()}}function Qn({getNodes:e,observeMutation:t=!0}){const[s,n]=l.useState([]),[a,o]=l.useState(0);return qn(()=>{const u=e(),d=u.map((m,h)=>Zn(m,i=>{n(c=>[...c.slice(0,h),i,...c.slice(h+1)])}));if(t){const m=u[0];d.push(Jn(m,()=>{o(h=>h+1)}))}return()=>{d.forEach(m=>{m==null||m()})}},[a]),s}function es(e){return typeof e=="object"&&e!==null&&"current"in e}function ts(e){const[t]=Qn({observeMutation:!1,getNodes(){return[es(e)?e.current:e]}});return t}function ns(e){var t;const{min:s=0,max:n=100,onChange:a,value:o,defaultValue:u,isReversed:d,direction:m="ltr",orientation:h="horizontal",id:i,isDisabled:c,isReadOnly:g,onChangeStart:p,onChangeEnd:j,step:y=1,getAriaValueText:S,"aria-valuetext":N,"aria-label":F,"aria-labelledby":J,name:O,focusThumbOnChange:k=!0,...P}=e,Ge=ke(p),G=ke(j),Ue=ke(S),T=Dn({isReversed:d,direction:m,orientation:h}),[Mt,me]=tn({value:o,defaultValue:u??rs(s,n),onChange:a}),[pe,He]=l.useState(!1),[xe,Ke]=l.useState(!1),ge=!(c||g),ve=(n-s)/10,U=y||(n-s)/100,b=Ce(Mt,s,n),Dt=n-b+s,We=lt(T?Dt:b,s,n),Q=h==="vertical",w=kt({min:s,max:n,step:y,isDisabled:c,value:b,isInteractive:ge,isReversed:T,isVertical:Q,eventSource:null,focusThumbOnChange:k,orientation:h}),ye=l.useRef(null),Se=l.useRef(null),Ye=l.useRef(null),Rt=l.useId(),Xe=i??Rt,[Ze,qe]=[`slider-thumb-${Xe}`,`slider-track-${Xe}`],zt=l.useCallback(f=>{var x,H;if(!ye.current)return;const C=w.current;C.eventSource="pointer";const M=ye.current.getBoundingClientRect(),{clientX:we,clientY:Ot}=(H=(x=f.touches)==null?void 0:x[0])!=null?H:f,Gt=Q?M.bottom-Ot:we-M.left,Ut=Q?M.height:M.width;let je=Gt/Ut;T&&(je=1-je);let K=fn(je,C.min,C.max);return C.step&&(K=parseFloat(ot(K,C.min,C.step))),K=Ce(K,C.min,C.max),K},[Q,T,w]),D=l.useCallback(f=>{const x=w.current;x.isInteractive&&(f=parseFloat(ot(f,x.min,U)),f=Ce(f,x.min,x.max),me(f))},[U,me,w]),R=l.useMemo(()=>({stepUp(f=U){const x=T?b-f:b+f;D(x)},stepDown(f=U){const x=T?b+f:b-f;D(x)},reset(){D(u||0)},stepTo(f){D(f)}}),[D,T,b,U,u]),Je=l.useCallback(f=>{const x=w.current,C={ArrowRight:()=>R.stepUp(),ArrowUp:()=>R.stepUp(),ArrowLeft:()=>R.stepDown(),ArrowDown:()=>R.stepDown(),PageUp:()=>R.stepUp(ve),PageDown:()=>R.stepDown(ve),Home:()=>D(x.min),End:()=>D(x.max)}[f.key];C&&(f.preventDefault(),f.stopPropagation(),C(f),x.eventSource="keyboard")},[R,D,ve,w]),Qe=(t=Ue==null?void 0:Ue(b))!=null?t:N,be=ts(Se),{getThumbStyle:et,rootStyle:tt,trackStyle:nt,innerTrackStyle:st}=l.useMemo(()=>{const f=w.current,x=be??{width:0,height:0};return Mn({isReversed:T,orientation:f.orientation,thumbRects:[x],thumbPercents:[We]})},[T,be,We,w]),rt=l.useCallback(()=>{w.current.focusThumbOnChange&&setTimeout(()=>{var x;return(x=Se.current)==null?void 0:x.focus()})},[w]);Ht(()=>{const f=w.current;rt(),f.eventSource==="keyboard"&&(G==null||G(f.value))},[b,G]);function at(f){const x=zt(f);x!=null&&x!==w.current.value&&me(x)}Xn(Ye,{onPanSessionStart(f){const x=w.current;x.isInteractive&&(He(!0),rt(),at(f),Ge==null||Ge(x.value))},onPanSessionEnd(){const f=w.current;f.isInteractive&&(He(!1),G==null||G(f.value))},onPan(f){w.current.isInteractive&&at(f)}});const At=l.useCallback((f={},x=null)=>({...f,...P,ref:Pe(x,Ye),tabIndex:-1,"aria-disabled":Ie(c),"data-focused":V(xe),style:{...f.style,...tt}}),[P,c,xe,tt]),Ft=l.useCallback((f={},x=null)=>({...f,ref:Pe(x,ye),id:qe,"data-disabled":V(c),style:{...f.style,...nt}}),[c,qe,nt]),Vt=l.useCallback((f={},x=null)=>({...f,ref:x,style:{...f.style,...st}}),[st]),$t=l.useCallback((f={},x=null)=>({...f,ref:Pe(x,Se),role:"slider",tabIndex:ge?0:void 0,id:Ze,"data-active":V(pe),"aria-valuetext":Qe,"aria-valuemin":s,"aria-valuemax":n,"aria-valuenow":b,"aria-orientation":h,"aria-disabled":Ie(c),"aria-readonly":Ie(g),"aria-label":F,"aria-labelledby":F?void 0:J,style:{...f.style,...et(0)},onKeyDown:Te(f.onKeyDown,Je),onFocus:Te(f.onFocus,()=>Ke(!0)),onBlur:Te(f.onBlur,()=>Ke(!1))}),[ge,Ze,pe,Qe,s,n,b,h,c,g,F,J,et,Je]),Bt=l.useCallback((f,x=null)=>{const H=!(f.value<s||f.value>n),C=b>=f.value,M=lt(f.value,s,n),we={position:"absolute",pointerEvents:"none",...ss({orientation:h,vertical:{bottom:T?`${100-M}%`:`${M}%`},horizontal:{left:T?`${100-M}%`:`${M}%`}})};return{...f,ref:x,role:"presentation","aria-hidden":!0,"data-disabled":V(c),"data-invalid":V(!H),"data-highlighted":V(C),style:{...f.style,...we}}},[c,T,n,s,h,b]),Lt=l.useCallback((f={},x=null)=>({...f,ref:x,type:"hidden",value:b,name:O}),[O,b]);return{state:{value:b,isFocused:xe,isDragging:pe},actions:R,getRootProps:At,getTrackProps:Ft,getInnerTrackProps:Vt,getThumbProps:$t,getMarkerProps:Bt,getInputProps:Lt}}function ss(e){const{orientation:t,vertical:s,horizontal:n}=e;return t==="vertical"?s:n}function rs(e,t){return t<e?e:e+(t-e)/2}var[as,de]=ht({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[os,he]=ht({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),Pt=z((e,t)=>{var s;const n={...e,orientation:(s=e==null?void 0:e.orientation)!=null?s:"horizontal"},a=ft("Slider",n),o=ie(n),{direction:u}=Kt();o.direction=u;const{getInputProps:d,getRootProps:m,...h}=ns(o),i=m(),c=d({},t);return r.jsx(as,{value:h,children:r.jsx(os,{value:a,children:r.jsxs(_.div,{...i,className:q("chakra-slider",n.className),__css:a.container,children:[n.children,r.jsx("input",{...c})]})})})});Pt.displayName="Slider";var Ct=z((e,t)=>{const{getThumbProps:s}=de(),n=he(),a=s(e,t);return r.jsx(_.div,{...a,className:q("chakra-slider__thumb",e.className),__css:n.thumb})});Ct.displayName="SliderThumb";var It=z((e,t)=>{const{getTrackProps:s}=de(),n=he(),a=s(e,t);return r.jsx(_.div,{...a,className:q("chakra-slider__track",e.className),__css:n.track})});It.displayName="SliderTrack";var Tt=z((e,t)=>{const{getInnerTrackProps:s}=de(),n=he(),a=s(e,t);return r.jsx(_.div,{...a,className:q("chakra-slider__filled-track",e.className),__css:n.filledTrack})});Tt.displayName="SliderFilledTrack";var ls=z((e,t)=>{const{getMarkerProps:s}=de(),n=he(),a=s(e,t);return r.jsx(_.div,{...a,className:q("chakra-slider__marker",e.className),__css:n.mark})});ls.displayName="SliderMark";var Ae=z(function(t,s){const n=ft("Switch",t),{spacing:a="0.5rem",children:o,...u}=ie(t),{getIndicatorProps:d,getInputProps:m,getCheckboxProps:h,getRootProps:i,getLabelProps:c}=jn(u),g=l.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...n.container}),[n.container]),p=l.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...n.track}),[n.track]),j=l.useMemo(()=>({userSelect:"none",marginStart:a,...n.label}),[a,n.label]);return r.jsxs(_.label,{...i(),className:$e("chakra-switch",t.className),__css:g,children:[r.jsx("input",{className:"chakra-switch__input",...m({},s)}),r.jsx(_.span,{...h(),className:"chakra-switch__track",__css:p,children:r.jsx(_.span,{__css:n.thumb,className:"chakra-switch__thumb",...d()})}),o&&r.jsx(_.span,{className:"chakra-switch__label",...c(),__css:j,children:o})]})});Ae.displayName="Switch";function is(e,t=[]){const s=Object.assign({},e);for(const n of t)n in s&&delete s[n];return s}var cs=["h","minH","height","minHeight"],Nt=z((e,t)=>{const s=dt("Textarea",e),{className:n,rows:a,...o}=ie(e),u=nn(o),d=a?is(s,cs):s;return r.jsx(_.textarea,{ref:t,rows:a,...u,className:$e("chakra-textarea",n),__css:d})});Nt.displayName="Textarea";var us=Be("chevron-left","IconChevronLeft",[["path",{d:"M15 6l-6 6l6 6",key:"svg-0"}]]),ds=Be("pin-filled","IconPinFilled",[["path",{d:"M15.113 3.21l.094 .083l5.5 5.5a1 1 0 0 1 -1.175 1.59l-3.172 3.171l-1.424 3.797a1 1 0 0 1 -.158 .277l-.07 .08l-1.5 1.5a1 1 0 0 1 -1.32 .082l-.095 -.083l-2.793 -2.792l-3.793 3.792a1 1 0 0 1 -1.497 -1.32l.083 -.094l3.792 -3.793l-2.792 -2.793a1 1 0 0 1 -.083 -1.32l.083 -.094l1.5 -1.5a1 1 0 0 1 .258 -.187l.098 -.042l3.796 -1.425l3.171 -3.17a1 1 0 0 1 1.497 -1.26z",fill:"currentColor",key:"svg-0",strokeWidth:"0"}]]),hs=Be("pin","IconPin",[["path",{d:"M15 4.5l-4 4l-4 1.5l-1.5 1.5l7 7l1.5 -1.5l1.5 -4l4 -4",key:"svg-0"}],["path",{d:"M9 15l-4.5 4.5",key:"svg-1"}],["path",{d:"M14.5 4l5.5 5.5",key:"svg-2"}]]);const fs=({setMediaAct:e,media:t,currentNum:s})=>{const n=u=>{const d=(s+u+t.length)%t.length;e&&e(t[d])},a={width:"100%",height:"100%"};if(t.length===0)return r.jsx("p",{children:"No images found, let's start generating 🪄"});const o=t.at(s);return o?r.jsxs(v,{justifyContent:"center",alignItems:"center",position:"relative",width:a.width,height:a.height,overflow:"hidden",children:[r.jsx("div",{style:{position:"absolute",cursor:"pointer",width:"100%",height:"100%"},onClick:()=>{window.open(o.imageUrl)},children:sn(o.imageUrl)?r.jsx(rn,{src:o.imageUrl,alt:`image-${o.id}`,width:"100%",height:"100%",objectFit:"contain"}):r.jsx("video",{style:{objectFit:"contain"},width:"100%",height:"100%",src:o.imageUrl,loop:!0,autoPlay:!0,muted:!0,children:r.jsx("track",{kind:"captions"})})},o.id),r.jsx(A,{size:"sm",color:"white",bgColor:"whiteAlpha.400","aria-label":"Previous image",icon:r.jsx(us,{}),onClick:()=>n(-1),position:"absolute",left:"0",zIndex:"2"}),r.jsx(A,{size:"sm",color:"white",bgColor:"whiteAlpha.400","aria-label":"Next image",icon:r.jsx(mn,{}),onClick:()=>n(1),position:"absolute",right:"0",zIndex:"2"})]}):null},ms=({inputItem:e})=>r.jsxs(v,{gap:2,children:[r.jsx(v,{gap:1,alignItems:"center",flexBasis:"200px",children:e.label??e.inputName}),r.jsx(an,{value:e.inputValue,onChange:t=>{}})]}),ps=e=>{const t=e.inputItem;return r.jsxs(v,{gap:1,direction:"column",children:[r.jsxs(v,{gap:2,children:[r.jsx(v,{gap:1,alignItems:"center",flexBasis:"200px",children:t.label??t.inputName}),r.jsxs(pn,{width:"100%",step:e==null?void 0:e.step,value:t.inputValue,min:e==null?void 0:e.min,max:e==null?void 0:e.max,onChange:s=>{},children:[r.jsx(xn,{}),r.jsxs(gn,{children:[r.jsx(vn,{}),r.jsx(yn,{})]})]})]}),r.jsx(v,{children:r.jsxs(Pt,{maxWidth:"400px",step:e==null?void 0:e.step,value:Number(t.inputValue),min:(e==null?void 0:e.min)??0,max:(e==null?void 0:e.max)??100,onChange:s=>{},children:[r.jsx(It,{children:r.jsx(Tt,{})}),r.jsx(Ct,{})]})})]})},xs=e=>{var s;const{inputItem:t}=e;return r.jsxs(v,{gap:2,children:[r.jsx(v,{gap:1,alignItems:"center",flexBasis:"200px",children:t.label??t.inputName}),r.jsx(wn,{value:t.inputValue,onChange:n=>{},children:(s=e==null?void 0:e.options)==null?void 0:s.map((n,a)=>r.jsx("option",{value:n,children:n},`select${t.nodeID}${t.inputName}${a}`))})]})},gs=e=>{const t=e.inputItem;return r.jsxs(v,{gap:1,direction:"column",children:[r.jsx(v,{children:t.label??t.inputName}),r.jsx(Nt,{value:t.inputValue,onChange:s=>{},rows:5})]})};var I=(e=>(e.Input="Input",e.InputSlider="InputSlider",e.Select="Select",e.Textarea="Textarea",e.Checkbox="Checkbox",e.NoSupport="NoSupport",e))(I||{});const vs=e=>r.jsxs(v,{gap:2,children:[r.jsx(v,{gap:1,alignItems:"center",flexBasis:"200px",children:e.inputItem.label??e.inputItem.inputName}),r.jsx(v,{children:"No Support"})]}),ys=e=>{const t=e.inputItem;return r.jsxs(v,{gap:2,children:[r.jsx(v,{gap:1,alignItems:"center",flexBasis:"200px",children:t.label??t.inputName}),r.jsx(Le,{defaultChecked:!!t.inputValue,onChange:s=>{var n;(n=e==null?void 0:e.updateMetaData)==null||n.call(e,{promptKey:e.promptKey,name:e.name,value:s.target.checked})}})]})},fe=l.createContext({topFields:[],calcInputList:[],showNodeName:!1,updateTopField(){}}),Ss={[I.Input]:ms,[I.InputSlider]:ps,[I.Select]:xs,[I.Textarea]:gs,[I.Checkbox]:ys,NoSupport:vs},bs=LiteGraph.registered_node_types;function ws(e,t){var a,o,u,d,m;const s=(a=bs[e])==null?void 0:a.nodeData,n={...((o=s==null?void 0:s.input)==null?void 0:o.required)??{},...((u=s==null?void 0:s.input)==null?void 0:u.optional)??{}}[t];return(n==null?void 0:n[0])==="STRING"?(d=n==null?void 0:n[1])!=null&&d.multiline?{type:I.Textarea}:{type:I.Input}:(n==null?void 0:n[0])==="BOOLEAN"?{type:I.Checkbox}:(n==null?void 0:n[0])==="FLOAT"?{...(n==null?void 0:n[1])??{},type:I.InputSlider}:(n==null?void 0:n[0])==="INT"?{...(n==null?void 0:n[1])??{},type:I.InputSlider}:Array.isArray(n==null?void 0:n[0])&&((m=n==null?void 0:n[0])!=null&&m.every(h=>typeof h=="string"))?{options:n==null?void 0:n[0],type:I.Select}:{type:I.NoSupport}}const Fe=({inputItem:e})=>{const t=ws(e.classType,e.inputName),[s,n]=l.useState(!1),a=Ss[t.type??"Input"],{updateTopField:o,topFields:u}=l.useContext(fe),d=e.children[0]==="negative"||e.children[0]==="positive"?`-${e.children[0]}`:"",m={...e,label:e.label??e.inputName+d};return r.jsxs(v,{alignItems:"center",onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),children:[r.jsx(A,{size:"xs",onClick:()=>o==null?void 0:o({name:e.inputName,promptKey:e.nodeID,class_type:e.classType}),variant:"ghost",icon:le(u,{name:e.inputName,promptKey:e.nodeID,classType:e.classType})?r.jsx(ds,{size:14}):r.jsx(hs,{size:14}),"aria-label":"pin"}),r.jsxs("div",{style:{flex:1},children:[r.jsx(a,{inputItem:m,...t}),e.latestInputVal!==void 0?r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[r.jsx(on,{size:"sm",variant:"outline",colorScheme:"blue",children:r.jsx(ln,{children:"Latest"})}),r.jsx(bt,{style:{flex:1,maxHeight:"80px",overflow:"auto"},colorScheme:"yellow",children:e.latestInputVal})]}):null]})]})};function js(){const{topFields:e,updateTopField:t,calcInputList:s}=l.useContext(fe);return e.length===0?null:r.jsx(r.Fragment,{children:r.jsx(v,{px:2,gap:2,direction:"column",children:e==null?void 0:e.map(n=>{const a=s.find(o=>o.nodeID==n.promptKey&&o.inputName===n.name&&o.classType===n.class_type);return!n.class_type||!a?null:r.jsx(Fe,{inputItem:a},`formTopField${n.promptKey}${n.name}`)})})})}let oe=[],Ve=new Set;function Et(e,t){if(!Ve.has(e.nodeID))return Ve.add(e.nodeID),Object.entries(e.inputs).forEach(([s,n])=>{if(Array.isArray(n)){const a=n[0];Et(t[a],t)}}),Object.entries(e.inputs).forEach(([s,n])=>{Array.isArray(n)||oe.push({classType:e.class_type,inputName:s,inputValue:n,nodeID:e.nodeID,children:e.children||[]})}),oe}function _t(e){oe=[],Ve=new Set;for(const t of Object.keys(e))e[t].nodeID=t,Object.entries(e[t].inputs).forEach(([s,n])=>{if(Array.isArray(n)){const a=n[0],o=e[a];o.children||(o.children=[]),o.children.push(s)}});for(const t of Object.keys(e))Et(e[t],e);return oe}function ks(){const{topFields:e,calcInputList:t,showNodeName:s}=l.useContext(fe),{curFlowID:n}=l.useContext(ce),a=l.useCallback(i=>{const c=[];return i.forEach(g=>{const p=c[c.length-1];!p||p[0].nodeID!==g.nodeID||p[0].classType!==g.classType?c.push([g]):p.push(g)}),c},[]);l.useEffect(()=>{},[s]);const[o,u]=l.useState(),[d,m]=l.useState([]);if(l.useEffect(()=>{if(!o)return;const i=_t(o);m(i)},[o]),l.useEffect(()=>{async function i(){ae.graphToPrompt(ae.graph).then(c=>{u(c.output)})}n&&i()},[n]),l.useEffect(()=>{t.forEach((i,c)=>{const g=d[c];i.nodeID===g.nodeID&&i.inputName===g.inputName&&g.inputValue!==i.inputValue&&(i.latestInputVal=g.inputValue)})},[d,t]),!s)return r.jsx(Me,{children:t.map((i,c)=>le(e,{name:i.inputName,promptKey:i.nodeID,classType:i.classType})?null:r.jsx(Fe,{inputItem:i},`form${i.nodeID}${i.inputName}`))});const h=a(t);return r.jsx(Me,{children:h.map(i=>i[0]?r.jsx(Ps,{title:i[0].classType+" #"+i[0].nodeID,children:r.jsx(v,{px:2,gap:1,direction:"column",children:i.map(c=>le(e,{name:c.inputName,promptKey:c.nodeID,classType:c.classType})?null:r.jsx(Fe,{inputItem:c},`form${c.nodeID}${c.inputName}`))})},i[0].nodeID):null)})}function Ps({title:e,children:t}){return r.jsxs(mt,{border:"1px",borderColor:"gray.500",borderRadius:"md",p:4,children:[r.jsx($,{size:"sm",mb:1,color:"GrayText",children:e}),r.jsx("div",{children:t})]})}const le=(e,t)=>e==null?void 0:e.some(s=>s.promptKey===(t==null?void 0:t.promptKey)&&s.name===(t==null?void 0:t.name)&&s.class_type===t.classType);function Cs({media:e}){const[t,s]=l.useState([]),{curFlowID:n}=l.useContext(ce),[a,o]=l.useState(),[u,d]=l.useState(!0),[m,h]=l.useState(!0);l.useEffect(()=>{e?cn(`/workspace/view_media?filename=${e.localPath}`).then(p=>{o(p.prompt)}):ae.graphToPrompt(ae.graph).then(p=>{o(p.output)})},[e]),l.useEffect(()=>{if(!a)return;const p=_t(a);s(p)},[a]);const[i,c]=l.useState([]);l.useEffect(()=>{(async()=>{var p,j;if(n){const y=(j=await((p=ne)==null?void 0:p.get(n)))==null?void 0:j.topFieldsConfig;y&&(c(y),d(!1))}})()},[n]);const g=p=>{var j,y;if(le(i,{name:p.name,promptKey:p==null?void 0:p.promptKey,classType:(p==null?void 0:p.class_type)??""})){const S=i.filter(N=>N.name!==p.name||N.promptKey!==p.promptKey);c(S),n&&((j=ne)==null||j.updateTopFields(n,{topFieldsConfig:S}))}else{const S=[...i,p];c(S),n&&((y=ne)==null||y.updateTopFields(n,{topFieldsConfig:S}))}};return r.jsx(fe.Provider,{value:{topFields:i,showNodeName:m,calcInputList:t,updateTopField:g},children:r.jsxs(v,{direction:"column",align:"stretch",gap:5,children:[r.jsx(js,{}),r.jsxs(Y,{children:[r.jsx("p",{children:"Show all inputs"}),r.jsx(Ae,{isChecked:u,onChange:p=>d(!u)}),r.jsx("p",{children:"Show node names"}),r.jsx(Ae,{isChecked:m,onChange:p=>h(!m)})]}),u&&r.jsx(ks,{})]})})}const Is=({media:e})=>r.jsxs(v,{overflowY:"auto",mb:4,direction:"column",gap:2,flex:1,children:[r.jsxs(v,{flexWrap:"wrap",gap:3,children:[r.jsx(v,{alignItems:"center",gap:2,children:(e==null?void 0:e.localPath)&&r.jsxs(r.Fragment,{children:[r.jsx($,{children:e==null?void 0:e.localPath}),r.jsx(W,{label:"Donwload image from gallery",children:r.jsx(De,{href:`/workspace/view_media?filename=${e==null?void 0:e.localPath}`,download:e==null?void 0:e.localPath,children:r.jsx(A,{size:"sm",icon:r.jsx(pt,{size:19}),"aria-label":"donwload image from gallery"})})})]})}),r.jsx(v,{gap:1,alignItems:"center",color:"GrayText",children:!!(e!=null&&e.createTime)&&r.jsxs(r.Fragment,{children:[r.jsx($,{children:"Created:"}),r.jsx($,{children:xt((e==null?void 0:e.createTime)??0,!0)})]})})]}),r.jsx(Cs,{media:e??null})]}),Oe=l.createContext({showAllImages:!1,curMedia:null,setCurMedia(){},setMediaList(){},setShowAllImages(){}}),_e=120;function Ts({mediaList:e}){const{curMedia:t,setCurMedia:s}=l.useContext(Oe);return r.jsxs(v,{gap:3,h:"100%",children:[r.jsxs(kn,{gridTemplateRows:e.length<=6?"1fr 20%":"1fr",flex:1,gap:2,children:[r.jsx(fs,{media:e.map(n=>({id:n.id,imageUrl:`/workspace/view_media?filename=${n.localPath}`})),currentNum:(e==null?void 0:e.findIndex(n=>n.id===(t==null?void 0:t.id)))??0,setMediaAct:n=>s((e==null?void 0:e.find(a=>a.id===n.id))??null)}),r.jsx(v,{wrap:"wrap",children:e==null?void 0:e.map(n=>r.jsx(mt,{display:"inline-block",p:1,borderRadius:"4px",width:`${_e+3}px`,height:`${_e+3}px`,cursor:"pointer",border:(t==null?void 0:t.id)===n.id?"1px solid gray":"",onClick:()=>s(n),children:r.jsx(gt,{mediaLocalPath:n.localPath,size:_e,objectFit:"contain",hideBrokenImage:!0,onBrokenLink:()=>{var a;(a=L)==null||a.delete(n.id)}})},`image-bottom-${n.id}`))})]}),r.jsx(Is,{media:t??void 0})]})}const Ns=({media:e,isSelecting:t,selectedID:s,onClickMedia:n})=>{const{curFlowID:o,loadFilePath:u}=l.useContext(ce),{showDialog:d}=Wt();if(e.localPath==null||o==null)return null;const m=r.jsxs(De,{isExternal:!0,onClick:()=>n(e),position:"relative",children:[t&&r.jsx(Le,{isChecked:s.includes(e.id),position:"absolute",top:2,left:2}),r.jsx(gt,{mediaLocalPath:e.localPath,size:180,onBrokenLink:()=>{var h;(h=L)==null||h.delete(e.id)},hideBrokenImage:!0,autoPlay:!0,isPreview:!0})]});return r.jsxs(Me,{width:180,mb:2,children:[r.jsx(W,{label:xt(e.createTime,!0),children:m}),r.jsx(W,{label:e.localPath,children:r.jsx($,{color:"GrayText",noOfLines:1,children:e.localPath})}),r.jsxs(Y,{hidden:t,gap:0,children:[r.jsx(Yt,{flexGrow:1,onClick:()=>d("How do you want to load this workflow?",[{label:"Load in new workflow",onClick:()=>{u(e.localPath)},colorScheme:"teal"},{label:"Overwrite current workflow",onClick:()=>u(e.localPath,!0),colorScheme:"red"}]),size:"sm",children:"Load"}),r.jsx(W,{label:"Donwload image from gallery",children:r.jsx(De,{href:`/workspace/view_media?filename=${e.localPath}`,download:e.localPath,children:r.jsx(A,{size:"sm",variant:"ghost",icon:r.jsx(pt,{size:19}),"aria-label":"donwload image from gallery"})})}),r.jsx(W,{label:"Remove image from gallery",children:r.jsx(A,{size:"sm",variant:"ghost",icon:r.jsx(un,{size:19}),"aria-label":"remove image from gallery",colorScheme:"red",onClick:async()=>{var i;confirm("Are you sure to remove this image from gallery? (won't delete image on your disk)")&&await((i=L)==null?void 0:i.delete(e.id))}})})]})]})},Es=Ns;function _s({searchQuery:e}){const[t,s]=l.useState([]),{setCurMedia:n,setShowAllImages:a,setMediaList:o}=l.useContext(Oe);l.useEffect(()=>{var d,m;e===""?(d=L)==null||d.listAll().then(h=>{s(h.slice(0,50)??[])}):(m=L)==null||m.filter(h=>{var i;return((i=h.workflowJSON)==null?void 0:i.includes(e))??!1}).then(h=>{s(h)})},[e]);const u=d=>{o([d].concat(t.filter(m=>m.id!==d.id))),n(d),a(!1)};return r.jsx(Y,{wrap:"wrap",children:t.map(d=>r.jsx(Es,{selectedID:[],media:d,isSelecting:!1,onClickMedia:u},d.id))})}function Us({onclose:e}){const{curFlowID:t}=l.useContext(ce),[s,n]=l.useState(""),[a,o]=l.useState([]),[u,d]=l.useState(!1),[m,h]=l.useState(""),[i,c]=l.useState([]),[g,p]=l.useState(),[j,y]=l.useState(""),S=Sn(j,300),[N,F]=l.useState(!1),J=async()=>{var P;if(t==null)return;const k=await((P=L)==null?void 0:P.listByWorkflowID(t));c(k??[]),k!=null&&k.length&&p(k[0])};if(l.useEffect(()=>{var k;J(),t&&((k=ne)==null||k.get(t).then(P=>{P&&(n(P.name),P!=null&&P.coverMediaPath&&h(P==null?void 0:P.coverMediaPath))}))},[]),t==null)return null;const O=i.length>0&&a.length===i.length;return r.jsx(Oe.Provider,{value:{curMedia:g??null,setCurMedia:p,setMediaList:c,showAllImages:N,setShowAllImages:F},children:r.jsxs(Xt,{isOpen:!0,onClose:e,blockScrollOnMount:!0,children:[r.jsx(Zt,{}),r.jsxs(qt,{width:"90%",maxWidth:"90vw",height:"90vh",children:[r.jsxs(Jt,{children:[r.jsxs(Y,{gap:2,mb:2,children:[r.jsxs(dn,{size:"md",mr:2,children:["Gallery - ",s]}),r.jsx(bn,{searchValue:j,onUpdateSearchValue:k=>{y(k),N||F(!0)},placeholder:"Search prompt, model name, etc.",style:{width:"300px"}})]}),u&&r.jsxs(Y,{gap:3,children:[r.jsx(Le,{isChecked:O,onChange:()=>{o(O?[]:i.map(k=>k.id))},children:"All"}),r.jsxs($,{fontSize:16,children:[a.length," Selected"]}),r.jsx(A,{size:"sm",icon:r.jsx(hn,{size:19}),onClick:()=>d(!1),"aria-label":"cancel"})]})]}),r.jsx(Qt,{}),r.jsx(en,{overflowY:"auto",children:N?r.jsx(_s,{searchQuery:S}):r.jsx(Ts,{mediaList:i})})]})]})})}export{Us as default};
